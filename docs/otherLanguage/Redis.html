<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis7学习笔记 | 何叨叨的个人博客</title>
    <meta name="description" content="我的个人网站">
    <meta name="generator" content="VitePress v1.5.0">
    <link rel="preload stylesheet" href="/assets/style.DWqWhI_t.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CsgrX1ei.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.BFVASP49.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CQii86iU.js">
    <link rel="modulepreload" href="/assets/docs_otherLanguage_Redis.md.Bdnvjvty.lean.js">
    <link rel="icon" href="https://heyingjiee.github.io/logo.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-b4698e35><!--[--><!--]--><!--[--><span tabindex="-1" data-v-3fcd140a></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-3fcd140a> Skip to content </a><!--]--><!----><header class="VPNav" data-v-b4698e35 data-v-7e26a588><div class="VPNavBar" data-v-7e26a588 data-v-83d15d13><div class="wrapper" data-v-83d15d13><div class="container" data-v-83d15d13><div class="title" data-v-83d15d13><div class="VPNavBarTitle" data-v-83d15d13 data-v-a9237cbf><a class="title" href="/" data-v-a9237cbf><!--[--><!--]--><!--[--><img class="VPImage logo" src="https://heyingjiee.github.io/logo.png" alt data-v-3bb83069><!--]--><span data-v-a9237cbf>何叨叨的个人博客</span><!--[--><!--]--></a></div></div><div class="content" data-v-83d15d13><div class="content-body" data-v-83d15d13><!--[--><!--]--><div class="VPNavBarSearch search" data-v-83d15d13><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-83d15d13 data-v-11546809><span id="main-nav-aria-label" class="visually-hidden" data-v-11546809> Main Navigation </span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>前端</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontBasic/JS%E9%87%8D%E5%88%B7%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>JS重刷笔记（持续更新）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontBasic/TS%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>TS笔记（持续更新）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontBasic/CSS%E6%8A%80%E6%9C%AF%E7%B2%BE%E7%82%BC.html" data-v-f1276386><!--[--><span data-v-f1276386>CSS笔记</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontBasic/Vue2%E9%87%8D%E5%88%B7%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Vue笔记</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontBasic/Nest.html" data-v-f1276386><!--[--><span data-v-f1276386>Nest笔记（持续更新）</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>移动端</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/mobileBasic/%E9%B8%BF%E8%92%99.html" data-v-f1276386><!--[--><span data-v-f1276386>鸿蒙Next</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/mobileBasic/Flutter.html" data-v-f1276386><!--[--><span data-v-f1276386>Flutter（暂停更新）</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>Go语言</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/golang/Go%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Go 基础</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/golang/GoWeb%E5%AD%A6%E4%B9%A0.html" data-v-f1276386><!--[--><span data-v-f1276386>Go Web（持续更新）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/golang/Go%E5%BE%AE%E6%9C%8D%E5%8A%A1.html" data-v-f1276386><!--[--><span data-v-f1276386>Go 微服务（持续更新）</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>编程基础</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programBasic/Git%E7%9B%B8%E5%85%B3%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Git</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programBasic/HTTPS%E5%8E%9F%E7%90%86.html" data-v-f1276386><!--[--><span data-v-f1276386>HTTPS原理</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programBasic/leetcode%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95.html" data-v-f1276386><!--[--><span data-v-f1276386>Leetcode学习</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programBasic/%E5%B8%B8%E7%94%A8%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%A3.html" data-v-f1276386><!--[--><span data-v-f1276386>常用服务端口</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>其他语言</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/otherLanguage/python%E7%88%AC%E8%99%AB%E8%BF%9B%E9%98%B6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Python爬虫</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/otherLanguage/c++%E4%BD%BF%E7%94%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>C/C++基础</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup active" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>其他技术</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link active" href="/docs/otherLanguage/Redis.html" data-v-f1276386><!--[--><span data-v-f1276386>Redis7</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/otherLanguage/Docker.html" data-v-f1276386><!--[--><span data-v-f1276386>Docker</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/otherLanguage/Nginx%E5%AD%A6%E4%B9%A0.html" data-v-f1276386><!--[--><span data-v-f1276386>Nginx（待补充）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/otherLanguage/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Linux基础</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>前端工程化</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontEngineering/%E9%A1%B9%E7%9B%AE%E9%85%8D%E7%BD%AE.html" data-v-f1276386><!--[--><span data-v-f1276386>前端项目配置</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontEngineering/NPM%E5%BA%94%E7%9F%A5%E5%BA%94%E4%BC%9A.html" data-v-f1276386><!--[--><span data-v-f1276386>NPM应知应会</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontEngineering/Gulp%E8%87%AA%E5%8A%A8%E5%8C%96%E7%A5%9E%E5%99%A8.html" data-v-f1276386><!--[--><span data-v-f1276386>Gulp自动化神器</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/frontEngineering/Vite.html" data-v-f1276386><!--[--><span data-v-f1276386>Vite</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-11546809 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-88e2e0f2><span class="text" data-v-88e2e0f2><!----><span data-v-88e2e0f2>工具</span><span class="vpi-chevron-down text-icon" data-v-88e2e0f2></span></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><div class="items" data-v-a4b699c5><!--[--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programTool/WebStorm.html" data-v-f1276386><!--[--><span data-v-f1276386>WebStorm</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programTool/Charles%E7%9A%84%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-f1276386><!--[--><span data-v-f1276386>Charles</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-a4b699c5 data-v-f1276386><a class="VPLink link" href="/docs/programTool/Mac%E4%BD%BF%E7%94%A8%E7%BB%8F%E9%AA%8C.html" data-v-f1276386><!--[--><span data-v-f1276386>Mac使用经验</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-83d15d13 data-v-63f60f5b><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-63f60f5b data-v-8dabe1a2 data-v-c06b3b67><span class="check" data-v-c06b3b67><span class="icon" data-v-c06b3b67><!--[--><span class="vpi-sun sun" data-v-8dabe1a2></span><span class="vpi-moon moon" data-v-8dabe1a2></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-83d15d13 data-v-ce00a8c0 data-v-1d70c28f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/heyingjiee" aria-label="github" target="_blank" rel="noopener" data-v-1d70c28f data-v-a4db73ef><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-83d15d13 data-v-af3df8a6 data-v-88e2e0f2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-88e2e0f2><span class="vpi-more-horizontal icon" data-v-88e2e0f2></span></button><div class="menu" data-v-88e2e0f2><div class="VPMenu" data-v-88e2e0f2 data-v-a4b699c5><!----><!--[--><!--[--><!----><div class="group" data-v-af3df8a6><div class="item appearance" data-v-af3df8a6><p class="label" data-v-af3df8a6>Appearance</p><div class="appearance-action" data-v-af3df8a6><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-af3df8a6 data-v-8dabe1a2 data-v-c06b3b67><span class="check" data-v-c06b3b67><span class="icon" data-v-c06b3b67><!--[--><span class="vpi-sun sun" data-v-8dabe1a2></span><span class="vpi-moon moon" data-v-8dabe1a2></span><!--]--></span></span></button></div></div></div><div class="group" data-v-af3df8a6><div class="item social-links" data-v-af3df8a6><div class="VPSocialLinks social-links-list" data-v-af3df8a6 data-v-1d70c28f><!--[--><a class="VPSocialLink no-icon" href="https://github.com/heyingjiee" aria-label="github" target="_blank" rel="noopener" data-v-1d70c28f data-v-a4db73ef><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-83d15d13 data-v-de379d94><span class="container" data-v-de379d94><span class="top" data-v-de379d94></span><span class="middle" data-v-de379d94></span><span class="bottom" data-v-de379d94></span></span></button></div></div></div></div><div class="divider" data-v-83d15d13><div class="divider-line" data-v-83d15d13></div></div></div><!----></header><div class="VPLocalNav empty fixed" data-v-b4698e35 data-v-bc2399bb><div class="container" data-v-bc2399bb><!----><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-bc2399bb data-v-42930da9><button data-v-42930da9>Return to top</button><!----></div></div></div><!----><div class="VPContent" id="VPContent" data-v-b4698e35 data-v-45de3600><div class="VPDoc has-aside" data-v-45de3600 data-v-16c4b07c><!--[--><!--]--><div class="container" data-v-16c4b07c><div class="aside" data-v-16c4b07c><div class="aside-curtain" data-v-16c4b07c></div><div class="aside-container" data-v-16c4b07c><div class="aside-content" data-v-16c4b07c><div class="VPDocAside" data-v-16c4b07c data-v-8f9377a8><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-8f9377a8 data-v-94cfffdf><div class="content" data-v-94cfffdf><div class="outline-marker" data-v-94cfffdf></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-94cfffdf>文章大纲</div><ul class="VPDocOutlineItem root" data-v-94cfffdf data-v-34d5ef8a><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-8f9377a8></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-16c4b07c><div class="content-container" data-v-16c4b07c><!--[--><!--]--><main class="main" data-v-16c4b07c><div style="position:relative;" class="vp-doc _docs_otherLanguage_Redis" data-v-16c4b07c><div><h1 id="redis7学习笔记" tabindex="-1">Redis7学习笔记 <a class="header-anchor" href="#redis7学习笔记" aria-label="Permalink to &quot;Redis7学习笔记&quot;">​</a></h1><p><a href="https://www.bilibili.com/video/BV1U24y1y7jF?p=4&amp;spm_id_from=pageDriver&amp;vd_source=e46d9099be60057b5a16a45fac0d5248" target="_blank" rel="noreferrer">学习视频</a></p><p><a href="https://pan.baidu.com/s/141HqMOV2dmdVUPFlBbrZMg" target="_blank" rel="noreferrer">学习笔记</a> 提取码: 4bcj</p><h2 id="概述" tabindex="-1">概述 <a class="header-anchor" href="#概述" aria-label="Permalink to &quot;概述&quot;">​</a></h2><h3 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h3><p>Redis（Remote Dictionary Server，远程字典服务），是一个使用 ANSI C 语言编写、支持网络、 可基于内存亦可持久化的日志型、NoSQL 开源内存数据库</p><h3 id="场景与分类" tabindex="-1">场景与分类 <a class="header-anchor" href="#场景与分类" aria-label="Permalink to &quot;场景与分类&quot;">​</a></h3><p>用户请求服务器，读相关的请求会先查Redis中是否存在</p><ul><li>不存在，去数据库查询后，同步到Redis中，然后返回给用户</li><li>存在，直接返回用户</li></ul><p>写相关的请求会直接写入数据库</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230917013531%20.png" alt="image-20230917013531396"></p><p>根据数据的特性，Redis缓存一般可划分为两类：</p><ul><li><p>实时同步缓存</p><p>DBMS 中数据更新后，Redis 缓存中的存放的相关数据会被立即清除，如果再有对该数据的请求，必须先从 DBMS 中查询获取到最新数据，然后再写入到 Redis</p></li><li><p>阶段性同步缓存 Redis 缓存中的数据允许在一段时间内与 DBMS 中的数据不完全一致，而这个时间段就是这个缓存数据的过期时间。如果再有对该数据的请求，必须先从 DBMS 中查询获取到最新数据，然后再写入到 Redis</p><p>服务部署后有一个warmup（预热）的过程，一般会在这个时机将一些阶段性同步的缓存先入到Redis中</p></li></ul><h3 id="优势" tabindex="-1">优势 <a class="header-anchor" href="#优势" aria-label="Permalink to &quot;优势&quot;">​</a></h3><ul><li><p>性能极高</p><p>Redis 读的速度可以达到 11w 次/s，写的速度可以达到 8w 次/s。只所以具有这么高的性能，因为以下几点原因：（1）Redis 的所有操作都是在内存中发生的。（2）Redis 是用 C 语言开发的。（3）Redis 源码非常精细（集性能与优雅于一身）</p></li><li><p>持久化</p><p>Redis 内存中的数据可以进行持久化（其有两种方式：RDB 与 AOF）</p></li><li><p>高可用集群</p><p>Redis 提供了高可用的主从集群功能，可以确保系统的安全性</p></li><li><p>丰富的数据类型 Redis 是一个 key-value 存储系统。支持存储的 value 类型很多，包括String(字符串)、List(链表)、Set(集合)、Zset(sorted set 有序集合)、Hash（哈希类型）、 BitMap、HyperLogLog、Geospatial 类型</p><ul><li><p>BitMap：一般用于大数据量的二值性统计</p></li><li><p>HyperLogLog（Hyperlog Log）：用于对数据量超级庞大的日志做去重统计</p></li><li><p>Geospatial：地理空间，其主要用于地理位置相关的计算</p></li></ul></li><li><p>强大的功能</p><p>Redis 提供了数据过期功能、发布/订阅功能、简单事务功能，还支持 Lua脚本扩展功能</p></li><li><p>支持 ACL 权限控制：</p><p>Redis6 开始引入了 ACL 模块，可以为不同用户定制不同的用户权限</p></li><li><p>支持多线程 IO 模型</p></li></ul><p>Redis 之前版本采用的是单线程模型，从 6.0 版本开始支持了多线程模型</p><h2 id="安装" tabindex="-1">安装 <a class="header-anchor" href="#安装" aria-label="Permalink to &quot;安装&quot;">​</a></h2><h3 id="前提准备" tabindex="-1">前提准备 <a class="header-anchor" href="#前提准备" aria-label="Permalink to &quot;前提准备&quot;">​</a></h3><p>我们这里使用虚拟机，将Redis安装到虚拟机上（CentOS系统）</p><p>创建虚拟机、通过SSH连接到虚拟机等可以参考这篇<a href="https://heyingjiee.github.io/otherLanguage/Linux%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85" target="_blank" rel="noreferrer">文章</a></p><h3 id="安装redis" tabindex="-1">安装Redis <a class="header-anchor" href="#安装redis" aria-label="Permalink to &quot;安装Redis&quot;">​</a></h3><p>官网：<a href="https://redis.io/" target="_blank" rel="noreferrer">https://redis.io/</a></p><p><strong>1、下载</strong></p><p>在本地下载压缩包，使用FTP上传到虚拟机中</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230917232753%20.png" alt="image-20230917232753126"></p><p><strong>2、虚拟机中解压、编译、安装</strong></p><p>解压（记住解压目录，修改Redis配置的配置文件在这里）</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tar</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -zxvf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx.tar.gz</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -C</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/apps</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #解压文件到/opt目录下(如果提示没有app文件夹，则使用mkdir app创建)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>编译、安装</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 编译环境</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> gcc-c++</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入解压后的redis目录，其中有一个Makefile文件，使用make编译</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>安装后，提示安装了下面三个部分：redis 服务器、客户端与性能测试工具benchmark</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230917235133%20.png" alt="image-20230917235133481"></p><p>安装后的结果：</p><ul><li><p>软件已被安装在/usr/local/bin这个目录下了</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230917235526%20.png" alt="image-20230917235525840"></p><p>环境变量也被自动配置好了</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $PATH </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>解压目录（我们这里是 /opt/app/redis）</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>其中，有redis配置文件、哨兵配置文件等各种配置相关的文件</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li></ul><h3 id="启动-停止" tabindex="-1">启动/停止 <a class="header-anchor" href="#启动-停止" aria-label="Permalink to &quot;启动/停止&quot;">​</a></h3><p><strong>方式一</strong></p><p>启动</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-server</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #使用默认redis配置，启动redis服务。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918000241%20.png" alt="image-20230918000241149"></p><p>停止：关闭窗口则停止</p><p><strong>方式二</strong></p><p>守护进程方式启动（不会随着窗口关闭，而关闭）</p><p>先修改配置文件，在redis安装目录下的redis.conf文件中开启配置</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918001633%20.png" alt="image-20230918001633232"></p><p>启动</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /opt/apps/redis/redis.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查看和redis相关的线程，通过这个就可以判断redis是否启动了</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918002722%20.png" alt="image-20230918002721938"></p><p>关闭</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 客户端发送关闭指令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shutdown</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果服务端启用了密码，通过-a 输出密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shutdown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="redis服务端配置" tabindex="-1">Redis服务端配置 <a class="header-anchor" href="#redis服务端配置" aria-label="Permalink to &quot;Redis服务端配置&quot;">​</a></h2><p>redis.conf中配置选项很多，推荐在vi、vim编辑器中使用下面的方式<strong>搜索</strong>配置</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">输入</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 进入查找模式</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">输入</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 查找关键词</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">输入</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 回车</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">输入</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> n</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 下一个</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">输入</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> esc退出查找模式</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><hr><h3 id="生产环境必须配置" tabindex="-1">生产环境必须配置 <a class="header-anchor" href="#生产环境必须配置" aria-label="Permalink to &quot;生产环境必须配置&quot;">​</a></h3><p>关闭绑定客户端IP、保护模式</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918003745%20.png" alt="image-20230918003744835"></p><p>开启密码</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918004452%20.png" alt="image-20230918004452634"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #进入交互模式(输入exit可退出交互模式)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #设置name:tom这个键值对，提示没权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #获取name的值，提示没权限</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">reids-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hedaodao</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #-a后是密码，进入交互模式，就有权限了</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>禁用危险命令</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230918005502%20.png" alt="image-20230918005501928"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rename-command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flushall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 清空 Redis 服务器上的所有数据库</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rename-command</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> flushdb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 清空当前选择的数据库（默认是数据库编号为0的数据库）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="network模块" tabindex="-1">network模块 <a class="header-anchor" href="#network模块" aria-label="Permalink to &quot;network模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924120605%20.png" alt="image-20230924120604959"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这两个配置前面讲过了。需要注释掉</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bind</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -::1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">protected-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启端口号</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 服务端与客户端建立TCP连接的队列容量，其值与Linux系统的somaxconn参数取最小值为实际的队列容量。 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询somaxconn值： cat /proc/sys/net/core/somaxconn </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询somaxconn值： vim /etc/sysctl.conf 文件添加 net.core.somaxconn=2048。使用sysctl -p 使得配置生效</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生产环境下（特别是高并发场景下），backlog 的值最好要大一些，否则可能会影响系统性能。所以一般设置somaxconn大点，tcp-backlog 就会生效了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcp-backlog</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 551</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 客户端与Redis服务器连接空闲时，超过多少时间断开连接。0表示默认值2小时，值设置为2m为2分钟</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">timeout</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 单位：秒。Redis服务端间隔多少时间检测下服务端是否存活，如果连续两次客户端未响应，则服务端断开连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tcp-keepalive</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="general模块" tabindex="-1">general模块 <a class="header-anchor" href="#general模块" aria-label="Permalink to &quot;general模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924120757%20.png" alt="image-20230924120756825"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认no，需修改为yes，以守护进程方式启动 ：redis-server xxxx/redis.conf </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">daemonize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 该配置用于指定 Redis 运行时 pid 写入的文件（前台启动+守护进程启动）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果注释掉该设置，守护进程启动：pid 文件为/var/run/redis.pid；前台启动（daemonize 为 no）：不生产 pid 文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/redis_6379.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志级别：debug（一般在开发和测试时使用）、verbose、notice（生产中使用）、warning（只记录非常重要/关键的信息）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loglevel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> notice</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定日志文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置为&quot;&quot;,代表如果前台启动，输出到控制台(标准输出)；如果是守护进程启动，不输出</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如设置为 /root/redis.log ，就是出输出到/root/redis.log文件中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置redis数据库的数据，默认16个数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">databases</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="security模块" tabindex="-1">security模块 <a class="header-anchor" href="#security模块" aria-label="Permalink to &quot;security模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924122502%20.png" alt="image-20230924122502046"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置密码，注释掉就可以不用密码了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requirepass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="client模块" tabindex="-1">client模块 <a class="header-anchor" href="#client模块" aria-label="Permalink to &quot;client模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924122859%20.png" alt="image-20230924122859244"></p><p>Linux系统中一个进程可以拥有的最大文件描述符数量（文件描述符基本上是对打开的文件、套接字或其他输入/输出资源的引用）</p><p>系统通过限制文件描述符的数量，可以控制进程可以消耗的资源，并防止它打开过多的文件，从而导致资源耗尽</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">ulimit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 查询系统限制</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>maxclients设置Redis服务能够连接的客户端数量，但是实际其不能超过（系统的限制的数量-32），32是Redis内部使用的文件描述符数量</p><p>要想修改系统限制</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/secutiry/limits.conf</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> hard nofile xxx</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> soft nofile xxx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;domain&gt;: 可以是用户名、用户组名，或者以@符号开头的用户组名。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;type&gt;: 指定限制的类型，可以是 soft（软限制）或 hard（硬限制）。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;item&gt;: 使用 nofile 来设置文件描述符的限制。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;value&gt;: 设置文件描述符的限制值。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="memory-management模块" tabindex="-1">memory management模块 <a class="header-anchor" href="#memory-management模块" aria-label="Permalink to &quot;memory management模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924150732%20.png" alt="image-20230924150731422"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置最大占用内存，如果超出则按照maxmamory-policy字段设置处理策略</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># maxmemory &lt;bytes&gt;</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Redis的内存逐出策略有8种，如下：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1、volatile-lru：使用近似 LRU 算法移除，仅适用于设置了过期时间的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2、allkeys-lru：使用近似 LRU 算法移除，可适用于所有类型的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3、volatile-lfu：使用近似 LFU 算法移除，仅适用于设置了过期时间的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4、allkeys-lfu：使用近似 LFU 算法移除，可适用于所有类型的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5、volatile-random：随机移除一个 key，仅适用于设置了过期时间的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6、allkeys-random：随机移除一个 key，可适用于所有类型的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 7、volatile-ttl：移除距离过期时间最近的 key。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 8、noeviction：不移除任何内容，只是在写操作时返回一个错误，默认值。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意：即使使用设置的策略后，仍超出内存限制，则对get操作正常返回，对于其他类似于set、lpush等返回错误</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># maxmamory-policy noeviction</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># LRU、LFU、ttl等逐出换成的算法是近似的（节省内存），这个属性用来指定挑选要删除的 key 的样本数量。默认5表示Redis从最近使用的5个key中挑选一个逐出内存，实践表明5也已经足够了，10非常准确但是内存占用太大</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># maxmemory-samples 5</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 移除容忍度。选出移出内存的key，并不是立即移除。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 0表示立即移除</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 10是默认值，一般不改动就是10</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># maxmemory-eviction-tenacity 10</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="threaded-i-o模块" tabindex="-1">threaded I/O模块 <a class="header-anchor" href="#threaded-i-o模块" aria-label="Permalink to &quot;threaded I/O模块&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924153919%20.png" alt="image-20230924153919378"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># io-threads 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#io-threads-do-reads no</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>下面截图是配置文件中，对于这两个配置的介绍：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924154343%20.png" alt="image-20230924154342919"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924154404%20.png" alt="image-20230924154403898"></p><h3 id="snapshotting模块" tabindex="-1">snapshotting模块 <a class="header-anchor" href="#snapshotting模块" aria-label="Permalink to &quot;snapshotting模块&quot;">​</a></h3><p>RDB持久化配置</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004194407%20.png" alt="image-20231004194407261"></p><p>详细参考<a href="#RDB">RDB</a></p><h3 id="append-only-mode模块" tabindex="-1">append only mode模块 <a class="header-anchor" href="#append-only-mode模块" aria-label="Permalink to &quot;append only mode模块&quot;">​</a></h3><p>AOF持久化配置</p><p>详细参考<a href="#AOF">AOF</a></p><h3 id="其他配置" tabindex="-1">其他配置 <a class="header-anchor" href="#其他配置" aria-label="Permalink to &quot;其他配置&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 使用指定文件，覆盖文件内的同名配置。（需要写在文件最后一行）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /xxx/test.conf</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="redis客户端" tabindex="-1">Redis客户端 <a class="header-anchor" href="#redis客户端" aria-label="Permalink to &quot;Redis客户端&quot;">​</a></h2><ul><li><p>命令行</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 地址</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 端口</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 密码</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>可视化工具</p><p><a href="https://github.com/qishibo/AnotherRedisDesktopManager/releases" target="_blank" rel="noreferrer">RedisDesktopManager</a></p></li></ul><p>注意：</p><p>Redis服务端需开启防火墙</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询防火墙是否开启6379端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --list-all</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924160949%20.png" alt="image-20230924160948936"></p><p>没有开启</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开启6379端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">firewall-cmd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --zone=public</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --add-port=6379/tcp</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --permanent</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 重启防火墙</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> firewalld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>再次查询防火墙规则，会发现port字段有了6379</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20230924161147%20.png" alt="image-20230924161147197"></p><h2 id="redis命令" tabindex="-1">Redis命令 <a class="header-anchor" href="#redis命令" aria-label="Permalink to &quot;Redis命令&quot;">​</a></h2><p>在redis-cli进入命令行交互模式</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #进入交互模式</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">exit</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #退出交互模式</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 交互模式下，tab键可以补全命令</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="基础命令" tabindex="-1">基础命令 <a class="header-anchor" href="#基础命令" aria-label="Permalink to &quot;基础命令&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 心跳命令 ping，服务端存活就会响应PONG</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ping</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 存储 key=name ， value=tom。默认存储在db0</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 切换为 db5，存储在db0中的数据这里看不到</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">select</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 5</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">127.0.0.1:6379[5] </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#会有一个[x],标识是几号数据库</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清空当前数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flushdb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 清空所有数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">flushall</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="配置相关" tabindex="-1">配置相关 <a class="header-anchor" href="#配置相关" aria-label="Permalink to &quot;配置相关&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取redis服务配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # xxx是配置名，比如: config get port</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> da</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 支持正则，匹配da开头的配置</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置配置（使用这个命令，我们就不必使用vim打开redis.conf再修改）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yyy</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 仅在内存中修改</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cinfig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewrite</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 必须执行这个，才能保证配置文件被修改</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#这种方案修改配置，不会造成</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="key操作" tabindex="-1">Key操作 <a class="header-anchor" href="#key操作" aria-label="Permalink to &quot;Key操作&quot;">​</a></h3><p>查找符合条件的key（该操作会阻塞进程，线上环境数据量很多 ，会阻塞业务，所以很少使用）</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">keys</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 所有key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # h开头的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 包含h的kkey</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>判断key是否存在</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">exists</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #返回1，表示存在</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>删除key</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">del</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 多个key之间用空格间隔</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">integer</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 删除成功的个数</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重命名</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将key1重命名为key2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>移动</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">remove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 把key1移动到db3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查询值的类型</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key1对应的value的类型</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有的类型：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 1、none (key 不存在)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2、string (字符串)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 3、list (列表)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 4、set (集合)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 5、zset (有序集)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 6、hash (哈希表)</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>存活时间</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置key的存活时间，过期后key-value被删除。即使rename仍然遵循设置的存活时间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 带有生存时间的 key被称为“易失的”(volatile)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">expire</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 单位s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pexpire</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 单位s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 取消存活时间，设为永久</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">persist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询剩余存活时间。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当 key 不存在时，返回 -2 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当 key 存在，但没有设置剩余生存时间时，返回 -1 </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当 key 存在，设置了剩余生存时间时，返回 对应剩余时间</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ttl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #单位s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pttl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #单位s</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>随机返回key，常用于判断当前db是否为空</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">randomkey</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&gt;(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nil</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #没有key</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>检索是否存在key，返回符合条件的key（替代keys命令）</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SCAN cursor [MATCH pattern] [COUNT count] [TYPE type]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 取(0,2]的key，即2个key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 筛选出来key名中包含h的</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mathc</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> *</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 筛选出来value为string的key</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scan</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> count</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> type</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> string</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="string类型value的操作" tabindex="-1">String类型Value的操作 <a class="header-anchor" href="#string类型value的操作" aria-label="Permalink to &quot;String类型Value的操作&quot;">​</a></h3><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置key value。key存在更行value，不存在创建key-value</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果value含有空格，用引号（单、双都可以）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;hello word&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nx，key在当前数据库不存在，才能成功。如果存在，返回nil</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 等价于setnx name tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># xx，key在当前数据库存在，才能成功（用于更新）</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xx</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置过期时间。ex是秒，px是毫秒</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ex</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #等价于setex name 200 tom</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> px</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #等价于psetex name 200 tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#获取key1的值后，在给key1设置新的值value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置多个键值对</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v3</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置多个键值对（key必须不存在，一旦有key存在，所有数据插入失败）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">msetnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> k3</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> v3</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取多个值（一旦有key不存在，则获取失败）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 追加value内容(如果key1存在且为字符串，则把value追加到原来的值后；不存在，则设置为value)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">append</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意：key不存在则初始化为0，在执行+1或-1。value不是数字，返回错误提示</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key对应的值+1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key对应的值-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incrby</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 数字</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key对应的值+数字 （可以是正、负，不能为小数）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">decrby</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 数字</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key对应的值-数字 （可以是正、负，不能为小数）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">incrbyfloat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 数字</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # key对应的值-数字 （可以是正、负、小数）</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 返回字符串的长度。如果key不存在，返回0；key不是字符串，返回错误</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">strlen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 返回value的切片, [0,5]之间的字节(并不会改变原字符串)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从5开始（包括5），用value1覆盖原value值。如果5超过了原value的长度，则中间使用\x00填充</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> value1</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="hash类型value的操作" tabindex="-1">Hash类型Value的操作 <a class="header-anchor" href="#hash类型value的操作" aria-label="Permalink to &quot;Hash类型Value的操作&quot;">​</a></h3><p>key的值是Hash类型，值类似对象是多个key-value形式</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置值，hset key field1 value1 field2 value2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hsetnx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #只有name、age都不存在，才能设置成功。否则，设置失败返回0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取值中field对应的value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取value中所有的 field+value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hgetall</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;name&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;jack&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;age&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;10&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有field</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hkeys</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有field的数量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hlen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 所有value</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hvals</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># value的长度（字节）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hstrlen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除指定field</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hdel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 是否存在field。返回0不存在，1存在</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hexists</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># field对应的value如果是数字，+2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hincrby</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 数字可正、可负，不可为小数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hincrbyfloat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 这个可以是小数</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="list类型value的操作" tabindex="-1">List类型Value的操作 <a class="header-anchor" href="#list类型value的操作" aria-label="Permalink to &quot;List类型Value的操作&quot;">​</a></h3><p>key的值是List类型，值类似数组是多个元素的形式</p><p>其底层实际是一个无头节点的双向链表</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从右侧入队，rpush key item1 item2 item3。key不存在，则创建后推入元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpush</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tomas</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从右侧入队。key不存在，直接返回0（仅用于追加元素）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpushx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tomas</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从左侧入队 lpush、lpushx</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从左侧出队，数字指定出队的元素数，不设置默认为1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lpop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [数字]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 从右侧出队</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [数字]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 出队一个元素的阻塞版本：blpop、blrpop。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果有元素就出队，没有就阻塞x秒，如果此时有元素就出队，没有元素返回nil</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 为0时代表一直阻塞，直到其中有元素（类似Go中的channel）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blpop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 阻塞10s</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">blpop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A中右出队有一个元素，在B的左侧入队。（A、B可以是同一个key，就变成了把List的最后一个元素，放在开头）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rpoplpush</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> A</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> B</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 打印数组 [0,最后一个]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元素个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">llen</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按索引查询元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lindex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按索引替换元素为xxx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 插入数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">linsert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> before</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lisi</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 在tom前，插入lisi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">linsert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> after</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lisi</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 在tom后，插入lisi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lrem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 从左到右，删除2个jack就结束</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lrem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # 从右到左，删除2个jack就结束</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lrem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # # 从左到右，删除第一个tom就结束</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 改变原list为[1,2]之间的切片</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ltrim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> names</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br></div></div><h3 id="set类型value的操作" tabindex="-1">Set类型Value的操作 <a class="header-anchor" href="#set类型value的操作" aria-label="Permalink to &quot;Set类型Value的操作&quot;">​</a></h3><p>Set 中的元素具有无序性与不可重复性</p><p>其底层都是 value 为 null 的 hash 表。也正因为此，才会引发无序性与不可重复性。</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加入数据 name:(jack,tom)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查看集合name中的数据</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">smembers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 集合元素个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 判断jack是否在集合name中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sismenber</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 把集合1的成员set1Elem，移入集合2。如果集合1没有set1Elem，则直接向集合2添加元素set1Elem</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">smove</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set2</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> set1Elem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 集合name中，移出元素jack、tom</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">srem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在集合中随机挑选4个元素输出，注意：并不移除元素（如果集合中就2个元素，就会输出全部数据。参数尽量不要为负数，可能会输出重复元素）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">srandmember</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在集合中随机移出2个元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">spop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><p>集合操作：交集、差集、并集</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 差集：集合x-集合y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdiff</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 输出差集</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sdiffstore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将差集存入res</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 交集</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinter</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sinterstore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将交集存入res</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 并集</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sunion</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sunion</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> res</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> y</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将并集存入res</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="zset类型value的操作" tabindex="-1">ZSet类型Value的操作 <a class="header-anchor" href="#zset类型value的操作" aria-label="Permalink to &quot;ZSet类型Value的操作&quot;">​</a></h3><p>ZSet 是有序集合，其与 Set 的不同之处是，有序 Set 中的每一个元素都有一个分值 score，Redis 会根据score 的值对集合进行由小到大的排序</p><p>其与 Set 集合都是元素不能重复，但元素的score</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加入数据 name:(tom,jack) ，按照分数从小到大排序，如果分数一样，按照字母排序</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 格式：score value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 集合元素个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zcard</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 集合全部数据（参数为索引） </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 集合元素（第二个参数可以为负数，-1表示到最后一个）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrange</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> withscores</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 集合元素+分数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按照分数筛选数据。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### 指定分数范围的三种形式，只输出符合条件的元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # [30,80]之间的元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (30 (80 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (30,80)之间的元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -inf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +inf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 正负无穷</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### withscores选项：输出元素+分数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> withscores</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### limit选项：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> limit</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 筛选结果中从索引0开始，输出3个元素</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 反着符合条件的元素输出，注意范围也得是从 大到小</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrevrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 符合分数区间内元素的个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zcount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 分数在[20,30]之间元素的个数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按元素查询其分数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查tom的分数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取元素所在索引</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrank</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 从集合头部开始，查tom的索引（从0开始）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrevrank</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 从集合尾部开始，tom所在的索引（从0开始）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 加减元素对应的分数 （数字也可是负数，就是减）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zincrby</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 移除元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrem</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按索引范围移除元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zremrangebyrank</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # [2,4]移除元素</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 按分数范围移除元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zremrangebyscore</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 80</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> #移出分数[50,80]的之间元素。支持开区间zremrangebyscore name (50 (80 表示移出分数(50,80)之间的元素</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p>集合中所有元素分数都是相同值时：可以根据元素字母范围查询</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查找：指定字母范围的元素</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ZRANGEBYLEX key min max [LIMIT offset count]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebylex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [a (b </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># zrangebylex的区间开闭情况，必须写出来</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zrangebylex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 正负无穷，用 - 、+ 表示</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 删除指定字母范围的元素</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">zremrangebylex</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (d [f </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如name中包含 b c (d dog e f] find，删除后结果是 b c d find</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="bitmap类型value的操作" tabindex="-1">BitMap类型Value的操作 <a class="header-anchor" href="#bitmap类型value的操作" aria-label="Permalink to &quot;BitMap类型Value的操作&quot;">​</a></h3><p>该数据类型本质上就是一个仅包含 0 和 1 的二进制字符串</p><p>适用于海量数据的统计</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231003223325%20.png" alt="image-20231003223325438"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># key是北京，设置其123位（offset）是1，代表123号投了支持票，0代表投了反对票</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意：设置123位，前面的0-122位会自动置为0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setbit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># key是北京，获取其123位</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getbit</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 123</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计所有数据中1的个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitcount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 统计[0,4]字节间1的个数（两个数字都可以是负的，代表倒数第几个）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitcount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取第一个为1的偏移量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitpos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取第一个为0的偏移量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitpos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取在[0,4]字节间，第一个为0的偏移量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitpos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>二进制操作</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># a、b进行与操作，结果放入dest中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> or</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 异或</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 非</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bitop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dest</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> b</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="hyperloglog类型value的操作" tabindex="-1">HyperLogLog类型Value的操作 <a class="header-anchor" href="#hyperloglog类型value的操作" aria-label="Permalink to &quot;HyperLogLog类型Value的操作&quot;">​</a></h3><p>HyperLogLog类型（超级日志记录）该数据类型可以简单理解为一个 set 集合，集合元素为字符串</p><p>HyperLogLog 是一种基数计数概率算法，通过该算法可以利用极小的内存完成去重数据的统计，且误差仅为0.81%</p><p>通常用于海量数据的统计元素个数</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加数据 key=courses课程，value=math、english</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pfadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> courses</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> math</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> english</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元素个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pfcount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> courses</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 多个key就是多个集合的并集中元素的个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pfcount</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 将key1、key2集合，合并到sum中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pfmerge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> key2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="geospatial类型value的操作" tabindex="-1">Geospatial类型Value的操作 <a class="header-anchor" href="#geospatial类型value的操作" aria-label="Permalink to &quot;Geospatial类型Value的操作&quot;">​</a></h3><p>描述地理位置的类型，本质上仍是一种集合，只不过集合元素比较特殊，由&lt;经度，纬度，名称&gt;三部分构成</p><p>经度：longitude ，有效经度为[-180，180]。正的表示东经，负的表示西经</p><p>纬度：latitude，有效纬度为[-85.05112878， 85.05112878]。正的表示北纬，负的表示南纬</p><p>用途：可以设置、查询某地理位置的经纬度，查询某范围内的空间元素，计算两空间元素间的距离等</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 添加经纬度 北京、东京</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">geoadd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capitals</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 116.3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 39.9</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 129.69</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 35.69</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tokyo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ca</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取capitals中的北京的经纬度</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">geopos</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capitals</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 获取北京、东京的距离(计算距离时，会假设地球是个完美的球体，所以会造成0.5%的误差)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">geodist</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capitals</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tokyo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定圆心、半径，返回范围内的 元素名称</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">georadius</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capitals</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 116</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 39</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KM</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 圆心116 39，半径1000单位千米</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## withcoord选项，返回 元素的名称+经纬度</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## withdist选项，返回 元素的名称+元素距离圆心距离</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## asc（从近到远） 、 desc（从远到近）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## count xx 返回xx个元素</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果中心点是集合中的点，可以使用下面的方式。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">georadiusbymember</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> capitals</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> beijing</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1000</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> KM</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 距离beijing这个元素1000KM的所有元素名称</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="订阅-发布命令" tabindex="-1">订阅/发布命令 <a class="header-anchor" href="#订阅-发布命令" aria-label="Permalink to &quot;订阅/发布命令&quot;">​</a></h3><p>如果功能要求很复杂，还是优先使用例如 RocketMQ、Kafka 等消息中间件</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 订阅频道new1、new2。执行后处于阻塞状态，等待相关频道的消息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">subscribe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 取消订阅频道</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">unsubscribe</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在频道new1，发布消息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">public</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new1</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;happy day&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>统计</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pubsub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> channels</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 列出当前被订阅的频道</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pubsub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> numsub</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> new1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 返回订阅频道new1的订阅者数量</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="redis底层" tabindex="-1">Redis底层 <a class="header-anchor" href="#redis底层" aria-label="Permalink to &quot;Redis底层&quot;">​</a></h2><h3 id="string类型底层" tabindex="-1">String类型底层 <a class="header-anchor" href="#string类型底层" aria-label="Permalink to &quot;String类型底层&quot;">​</a></h3><p>Redis中的所以类型其最终的元素都是字符串，这个字符串类型不同于C语言中的</p><p>我们称为简单动态字符串(Simple Dynamic String，SDS) ，其C语言结构如下：</p><div class="language-c vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">c</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">struct</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sdshdr {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// 字节数组，用于保存字符串</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	char</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> buf</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">[]</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// buf[]中已使用字节数量，称为 SDS 的长度</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">	int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> len;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">	// buf[]中尚未使用的字节数量</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> free;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>注意：Redis中不可变的字符串还是使用的是C中的字符串</p><p>例子：buf字段是C的字节数组，需要以<code>\0</code>结尾，但是len是不算<code>\0</code>的</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231002004206%20.png" alt="image-20231002004205697"></p><h3 id="hash、zset类型底层" tabindex="-1">Hash、ZSet类型底层 <a class="header-anchor" href="#hash、zset类型底层" aria-label="Permalink to &quot;Hash、ZSet类型底层&quot;">​</a></h3><p>其底层使用zipList（压缩列表）或者skipList（跳跃列表）</p><p>Redis如何判断使用哪种？进入redis命令行交互模式：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索zipList的两个配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zset-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-ziplist-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 元素字节数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;zset-max-ziplist-value&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;64&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 集合元素个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;zset-max-ziplist-entries&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;128&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>超过上面两个配置值，底层就会采用skipList</p><p>Redis7.0后，不再使用zipList，而是使用listPack替代</p><p><strong>zipList结构</strong></p><p>zipList（压缩列表）是一个经过特殊编码的用于存储字符串或整数的双向链表。 其底层数据结构由三部分构成：head、entries 与 end，这三部分在内存上是连续存放的。</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231002130842%20.png" alt="image-20231002130842357"></p><p>补充：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入redis命令行交互模式：</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可获取xxx的在其底层C语言中的具体类型</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">object</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encoding</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxx</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>listPack结构</strong></p><p>Redis7.0后，不再使用zipList，而是使用listPack，但为了兼容性，在Redis配置中仍然保留了 zipList 的相关属性</p><p>原因：zipList中的entries的每个entry元素都包含prevlength部分，用来记录上一个entry的长度，如果频繁出现插入、修改操作，会导致级联更新，在高并发的写操作场景下会极度降低Redis 的性能</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 搜索listPack的两个配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">config</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> get</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> zset-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-listpack-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;zset-max-listpack-entries&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;128&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;zset-max-listpack-value&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;64&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>创建一个Hash类型的数据，查看其底层类型</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">hset</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">object</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> encoding</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> employee</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # &quot;listpack&quot;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231002132759%20.png" alt="image-20231002132759628"></p><p><strong>skipList结构</strong></p><p>skipList（跳表）是一种随机化的数据结构，基于并联的链表，实现简单，查找效率较高</p><p>跳表是链表的一种，只不过在链表的基础上增加了跳跃功能。也正是这个跳跃功能，使得在查找元素时，能够提供较高的效率</p><p>可以参考这个：<a href="https://www.jianshu.com/p/9d8296562806" target="_blank" rel="noreferrer">https://www.jianshu.com/p/9d8296562806</a></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231003175847%20.png" alt="image-20231003175846969"></p><h3 id="list类型底层" tabindex="-1">List类型底层 <a class="header-anchor" href="#list类型底层" aria-label="Permalink to &quot;List类型底层&quot;">​</a></h3><p>List 的底层实现，使用 quickList</p><p>其是由多个zipList构成的</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231003181351%20.png" alt="image-20231003181350768"></p><h2 id="redis事务" tabindex="-1">Redis事务 <a class="header-anchor" href="#redis事务" aria-label="Permalink to &quot;Redis事务&quot;">​</a></h2><p>Redis 的事务的本质是一组命令的批处理。</p><p>这组命令在执行过程中会被顺序地、一次性全部执行完毕，只要<strong>没有出现语法错误</strong>，这组命令在执行期间是不会被中断</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multi</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> OK</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 进入了事务模式，会提示TX</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 下面开始指定事务中进行的一组操作</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUED</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> incr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> QUEUED</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行事务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exex</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 取消事务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> discard</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>注意：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">multi</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> incr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> age</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 执行事务</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">TX</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> exex</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 结果： name不能加1，这并不是语法错误，而是执行中发生的错误。所有incr name 执行失败，而 set age 20 则会执行成功</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="redis持久化" tabindex="-1">Redis持久化 <a class="header-anchor" href="#redis持久化" aria-label="Permalink to &quot;Redis持久化&quot;">​</a></h2><p>Redis 是一个内存数据库，所以其运行效率非常高。但内存中的数据是不持久的，若主机宕机或 Redis 关机重启，则内存中的数据全部丢失</p><p>所以，Redis 具有持久化功能，其会在特定时机按照设置以**快照（RDB）<strong>或</strong>操作日志（AOF）**的形式将数据持久化到磁盘</p><p>当启动时，自动从磁盘加载到内存中</p><p>过程如下：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004173703%20.png" alt="image-20231004173702860"></p><p>启动时，读取配置文件选择使用哪种方式：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004183441%20.png" alt="image-20231004183440866"></p><h3 id="rdb-默认开启" tabindex="-1">RDB（默认开启） <a class="header-anchor" href="#rdb-默认开启" aria-label="Permalink to &quot;RDB（默认开启）&quot;">​</a></h3><p><span id="RDB">RDB</span>（Redis DataBase）是指将内存中某一时刻的数据快照全量写入到指定的 rdb 文件的持久化技术</p><p>RDB 持久化默认是开启的。当 Redis 启动时会自动读取 RDB 快照文件，将数据从硬盘载入到内存，以恢复 Redis 关机前的数据库状态</p><p>开启RDB后（默认开启），在Redis安装目录下，会有一个dump.rdb文件用于存储持久化数据</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004173940%20.png" alt="image-20231004173940404"></p><p>如何进行RDB持久化：</p><ul><li><p>手动<strong>save</strong></p><p>save 命令可立即进行一次持久化保存</p><p>save 命令在执行期间会阻塞 redis-server 进程，直至持久化过程完毕。而在 redis-server 进程阻塞期间，Redis不能处理任何读写请求，无法对外提供服务，所以一般不使用</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004192047%20.png" alt="image-20231004192046712"></p></li><li><p>手动<strong>bgsave</strong></p><p>相当于后台运行的save，Redis服务进程会fork一个子进程，由该子进程负责完成保存，过程不会阻塞进程Redis服务器的读写操作（使用较多）</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004192218%20.png" alt="image-20231004192218562"></p><p>bgsave的流程：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231006205643%20.png" alt="image-20231006205643004"></p><p>注意：fork出的子进程和父进程共享内存资源，所以子进程可以复制内存中的数据到RDB文件中。Linux系统中一旦内存被共享，则该内存就变成只读的。当Redis在拷贝内存数据的过程中，如果有新的写入操作，Linux就会采用写时复制技术（Copy-On-Write，Linux会将数据写入一个新的非共享的内存区域A，待数据拷贝完成，再将A的数据追加到RDB临时文件中，最后重命名为dump.rdb文件），最终RDB文件中包含了所有内存数据</p></li><li><p>关机时自动触发</p></li><li><p>配置文件设置条件触发</p><p>在Redis配置文件中，进行配置。其本质仍然是bgsave，只不过是自动触发</p><p>补充：</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lastsave</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 返回最后一次持久化时间</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><hr><p>下面介绍snapshotting模块的配置：</p><p><strong>save</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004211329%20.png" alt="image-20231004211328980"></p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>不开启RDB持久化，save设置为&quot;&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>开启RDB持久化：</span></span>
<span class="line"><span> save 3600 1 300 100 60 10000 # 默认值</span></span>
<span class="line"><span> 60s内，如果超过10000次写操作，就触发一个持久化</span></span>
<span class="line"><span> 300s，，，， 100次</span></span>
<span class="line"><span> 3600，，，， 1次</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><strong>stop-write-on-bgsave-error</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004221953%20.png" alt="image-20231004221953659"></p><p>当RDB开启时，才生效</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开启这个时，当持久化失败后，redis无法执行其他写操作</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stop-write-on-bgsave-error:yes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>rdbcompression</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004221922%20.png" alt="image-20231004221922141"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 生成 dump.rdb 文件时开启压缩，可大幅降低文件的大小，加速主从集群中从节点的数据同步</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rdbcompression</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 默认开启</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>rdbchecksum</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004222523%20.png" alt="image-20231004222523590"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CRC64 校验和就被放置在了文件末尾。这使格式更能抵抗 RDB文件的损坏，但在保存和加载 RDB 文件时，性能会受到影响（约 10%）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rdbchecksum</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 默认开启</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>sanitize-dump-payload</strong></p><p>该配置用于设置在加载 RDB 文件或进行持久化时是否开启对 zipList、listPack 等数据的全面安全检测</p><ul><li>no：不检测</li><li>yes：总是检测</li><li>clients（默认）：只有当客户端连接时检测。排除了加载 RDB 文件与进行持久化时的检测。</li></ul><p>涉及到集群数据迁移时，应该设置为no</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004223108%20.png" alt="image-20231004223108231"></p><p><strong>dbfilename</strong></p><p>生成的rdb文件名</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004223431%20.png" alt="image-20231004223431399"></p><p><strong>dir</strong></p><p>生成的rdb、aof文件放置的目录，默认安装目录</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004224406%20.png" alt="image-20231004224406156"></p><p><strong>rdb-del-sync-files</strong></p><p>默认no，对于没有开启RDB和AOF持久化的副本实例，控制其是否删除rdb文件</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231004223532%20.png" alt="image-20231004223532357"></p></li></ul><p>RDB的缺点：可能会存在Redis因为意外的关闭，而丢失最近30s左右的数据（还没来的及触发备份rdb文件）。高并发情况下，30s会丢失大量数据</p><h3 id="aof" tabindex="-1">AOF <a class="header-anchor" href="#aof" aria-label="Permalink to &quot;AOF&quot;">​</a></h3><p><span id="AOF">AOF</span>（Append Only File）是指 Redis 将每一次的<strong>写操作</strong>都以日志的形式追加到一个 AOF 文件中的持久化技术。当需要恢复内存数据时，将这些写操作重新执行一次，便会恢复到之 前的内存数据状态。（注意AOF不会修改，如果删除某字段，这条删除命令会追加到文件尾部）</p><p>使用AOF持久化方案，发生严重事件：</p><ul><li>在发生在服务器断电时，仅丢失最后1s的写操作</li><li>发生Redis进程错误时（操作系统正常运行），仅丢失最后一次写操作</li></ul><h4 id="aof持久化触发" tabindex="-1">AOF持久化触发 <a class="header-anchor" href="#aof持久化触发" aria-label="Permalink to &quot;AOF持久化触发&quot;">​</a></h4><ul><li><p>自动触发</p><p>执行写操作</p></li><li><p>手动触发：bgsave</p><p>与rdb命令一样，但是底层实现不一样</p></li></ul><h4 id="rewrite-机制" tabindex="-1">Rewrite 机制 <a class="header-anchor" href="#rewrite-机制" aria-label="Permalink to &quot;Rewrite 机制&quot;">​</a></h4><p>随着使用时间的推移，AOF 文件会越来越大。为了防止 AOF 文件由于太大而占用大量 的磁盘空间，降低性能，Redis 引入了 Rewrite 机制来对 AOF 文件进行压缩。</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 类似下面这种，name最终值是最后一次的值，如果aof记录多条多数据会浪费大量空间。所以需要rewrite</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tom</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jack</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><strong>Rewrite过程</strong></p><p>当 Rewrite 开启后，主进程 redis-server 创建出一个子进程 bgrewriteaof，由该子进程完成 rewrite 过程。其首先对现有 aof 文件进行rewrite 计算，将计算结果写入到一个临时文件，写入完毕后，再 rename 该临时文件为原 aof 文件名，覆盖原有文件</p><p><strong>触发条件</strong></p><ul><li><p>手动触发</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>bgrewriteaof</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>自动触发</p><p>通过redis.conf配置文件设置</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014230633%20.png" alt="image-20231014230633006"></p><p>redis将最后一次rewrite的aof文件的大小作为基础size。</p><p>如果文件大小超过auto-aof-rewrite-percentage设置的百分比，就会触发rewrite</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>auto-aof-rewrite-percentage  # 开启 rewrite 的增大比例，默认100%。指定为0，表示禁用自动 rewrite。</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>auto-aof-rewrite-min-size # 开启 rewrite 的 AOF 文件最小值，默认 64M。该值的设置主要是为了防止小 AOF 文件被 rewrite，从而导致性能下降。</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul><h4 id="aof基础配置" tabindex="-1">AOF基础配置 <a class="header-anchor" href="#aof基础配置" aria-label="Permalink to &quot;AOF基础配置&quot;">​</a></h4><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014002330%20.png" alt="image-20231014002330039"></p><p><strong>appendonly</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014003240%20.png" alt="image-20231014003240004"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 默认关闭，设置为yes开启AOF。RDB与AOF都开启，Redis会使用aof文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendonly</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>appendfilename、appenddirname</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014003337%20.png" alt="image-20231014003337146"></p><p>aof的配置文件不是一个，而是多个文件。他们都放在appenddirname指定的目录下</p><p>包含三种文件，appendfilename用指定前缀，默认appendonly.aof</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>基础文件：完整的数据库备份</span></span>
<span class="line"><span>    appendonly.aof.base.rdb</span></span>
<span class="line"><span>    </span></span>
<span class="line"><span>增量文件：用来记录每一条写命令，可能会有多个</span></span>
<span class="line"><span>		appendonly.aof.1.incr.aof</span></span>
<span class="line"><span>		appendonly.aof.2.incr.aof</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>清单文件：</span></span>
<span class="line"><span>		appendonly.aof.manifest 记录前面生成的所有文件，还有增量文件的顺序</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><strong>aof-timestamp-enabled</strong></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aof-timestamp-enabled</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 默认yes，即基础文件使用rdb格式（no表示使用aof格式文件作为基础文件格式，但是不要修改为no这个配置）</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h4 id="aof性能配置" tabindex="-1">AOF性能配置 <a class="header-anchor" href="#aof性能配置" aria-label="Permalink to &quot;AOF性能配置&quot;">​</a></h4><p><strong>appendfsync（配置bgsave进程写）</strong></p><p>Redis写入文件，调用系统调用fsync的时机</p><p>补充：操作系统写入数据时，会先写入系统缓存，当达到一定阈值后才写入文件，或者调用主动fsync写入文件（fsync是一个将数据从操作系统缓冲区刷新到磁盘的同步操作）</p><p>appendfsync配置用来指定bgsave子进程（与rdb一样，aof文件写入也是bgsave，只不过两者底层实现不同）写入aof文件的方式：</p><ul><li><p>默认为everysec，即每秒写入磁盘（推荐）</p></li><li><p>always，即每次执行写AOF文件的操作都写入磁盘（性能太低了）</p></li><li><p>no，由操作系统决定写入</p></li></ul><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014231548%20.png" alt="image-20231014231547727"></p><p><strong>no-appendfsync-on-rewrite（配置Redis主进程写）</strong></p><p>在appendfsync设置为always（默认）、everysec时，这个配置才生效</p><ul><li>默认值为no，主进程会正常调用fsync（配置项是no-appendfsync-xxx，配置是no，就是双重否定表示肯定）</li><li>yes，表示当bgsave或bgrewriteaof子进程运行，主进程不会调用fsync</li></ul><p>图里注释解释了，大量的fsync会阻塞Redis主进程对外提供服务，默认的no会造成性能下降</p><p>但是，很少有高并发的写操作，所以还是默认推荐no</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014232616%20.png" alt="image-20231014232615793"></p><p><strong>aof-rewrite-incremental-fsync（配置bgrewriteaof进程写）</strong></p><p>yes，即rewrite进程没生成4MB文件就调用fsync写入一次磁盘</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014235000%20.png" alt="image-20231014234959699"></p><p><strong>aof-load-truncated</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014235248%20.png" alt="image-20231014235248493"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aof-load-truncated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当在aof文件末尾丢失了数据 。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 比如 : 最后一行丢失</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">2</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">name</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">$4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tom</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># yes 会尽可能加载更多的正确数据后启动。例子：会直接丢掉name:tom这个键值对</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># no 不会启动( ps aux | grep redis 查看是否启动)。必须使用 redis-check-aof 工具修复后，才能启动Redis</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 注意：如果在文件中间丢失，Redis是不能启动的，会抛出错误</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>在 /usr/local/bin下有一个 redis-check-aof 工具（可以在全局使用的），用来修复aof文件</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 检查aof文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-check-aof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> appendonly.aof.1.incr.aof</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 修复aof文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-check-aof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --fix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  appendonly.aof.1.incr.aof</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>例子：</p><p>appendonly.aof.1.incr.aof 文件（缺失了name：xxx 中的xxx）</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231017010647%20.png" alt="image-20231017010647755"></p><p>检查文件</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231017010240%20.png" alt="image-20231017010240067"></p><p>修复文件</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231017010941%20.png" alt="image-20231017010941714"></p><p>修复结果</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231017011117%20.png" alt="image-20231017011117264"></p><p><strong>aof-timestamp-enabled</strong></p><p>给aof文件增加时间戳，但是默认解析器不支持，所以保持no</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014235125%20.png" alt="image-20231014235124960"></p><h4 id="aof文件格式" tabindex="-1">AOF文件格式 <a class="header-anchor" href="#aof文件格式" aria-label="Permalink to &quot;AOF文件格式&quot;">​</a></h4><p>执行写命令</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>set name jack</span></span>
<span class="line"><span></span></span>
<span class="line"><span>set age 18</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>查看文件：</p><ul><li><p>appendonly.aof.1.base.rdb (基础文件)</p><p>是个rdb文件，是仓库的完整快照</p></li><li><p>appendonly.aof.1.incr.aof 文件 （增量文件）</p><p>文本是以行来划分，每行以<code>\r\n </code>结束。每一行都有一个消息头，来表示消息类型。消息头有六个不同字符：</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>(*) 表示消息体总共有多少行，不包括当前行</span></span>
<span class="line"><span>($) 表示下一行消息数据的长度，不包括换行符长度\r\n</span></span>
<span class="line"><span>(+) 表示一个正确的状态信息</span></span>
<span class="line"><span>(-) 表示一个错误信息</span></span>
<span class="line"><span>(:) 表示返回一个数值</span></span>
<span class="line"><span>(空) 表示一个消息数据</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014222931%20.png" alt="image-20231014222931496"></p></li><li><p>appendonly.aof.manifest 文件（清单文件）</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>type b 代表是基础文件</span></span>
<span class="line"><span>type i 代表是增量文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>seq 是顺序</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231014223436%20.png" alt="image-20231014223436044"></p></li></ul><h4 id="流程总结" tabindex="-1">流程总结 <a class="header-anchor" href="#流程总结" aria-label="Permalink to &quot;流程总结&quot;">​</a></h4><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231021230151%20.png" alt="image-20231021230150722"></p><h3 id="对比" tabindex="-1">对比 <a class="header-anchor" href="#对比" aria-label="Permalink to &quot;对比&quot;">​</a></h3><p><strong>RDB与AOF</strong></p><p>优点</p><ul><li>rdb文件是二进制，数据较小（AOF本质是个写操作的日志，体积会越来越大）</li><li>二进制文件加载到内存很快（AOF本质是将写操作从新执行，速度慢）</li></ul><p>缺点</p><ul><li><p>rdb文件是二进制可读性差（AOF可读性强）</p></li><li><p>容易丢失数据（AOF安全性强，仅仅会丢失最后1s或者最后一次的写操作）</p><p>全量保存快照文件，过程中发生宕机数据会丢失</p><p>rdb的持久化策略，是时间范围内达到触发次数时，进行持久化。如果未达到条件时就宕机，也会导致部分数据丢失</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>save 3600 1 300 100 60 10000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>写时复制回降低性能</p><p>备份rdb文件时，Redis主进程由于和bgsave子进程共享内存，导致主进程无法写入数据，这时候必须使用写时复制，这会降低性能</p></li></ul><p><strong>如何选择</strong></p><p>无需使用持久化技术：仅使用Redis作为缓存系统</p><p>纯rdb方案：如果对数据安全性要求不高（可以容忍部分数据丢失）</p><p>纯aof方案：不使用，因为aof太慢了，性能差</p><p>rdb+aof混合持久化：推荐方案</p><h2 id="性能测试工具" tabindex="-1">性能测试工具 <a class="header-anchor" href="#性能测试工具" aria-label="Permalink to &quot;性能测试工具&quot;">​</a></h2><p>redis-benchmark用于对Redis做的性能测试，可执行文件在下面目录内</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/local/bin/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>查询所有命令说明</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>redis-benchmark --help</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>使用方式非常清晰：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231001181104%20.png" alt="image-20231001181103789"></p><p>注意：redis-benchmark指定的host、port都是redis服务的地址</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -h、-c都是默认值可以省略</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-benchmark</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -h</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200000</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这个命令会将Redis左右的操作都重试一遍</p><p>我们以输出中的LPUSH部分为例子：</p><div class="language-text vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>====== LPUSH ======                                                  </span></span>
<span class="line"><span>  200000 requests completed in 24.45 seconds</span></span>
<span class="line"><span>  100 parallel clients # 1000客户端并发，-c可以指定</span></span>
<span class="line"><span>  3 bytes payload # 读写的对象都是3字节，-d可以指定</span></span>
<span class="line"><span>  keep alive: 1 # 是否保持连接状态，1表示开启，-k可以指定</span></span>
<span class="line"><span>  host configuration &quot;save&quot;: 3600 1 300 100 60 10000</span></span>
<span class="line"><span>  host configuration &quot;appendonly&quot;: no</span></span>
<span class="line"><span>  multi-thread: no # 服务端是否开启多线程，这个需修改redis配置文件的io-threads字段</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 每次增长剩余请求百分比的一半时，统计请求完成的百分比分布</span></span>
<span class="line"><span>Latency by percentile distribution:</span></span>
<span class="line"><span>0.000% &lt;= 5.159 milliseconds (cumulative count 1)</span></span>
<span class="line"><span># 以这个为例子，完成了50%（100111个）的请求，花费了9.087毫秒</span></span>
<span class="line"><span>50.000% &lt;= 9.087 milliseconds (cumulative count 100111)</span></span>
<span class="line"><span>75.000% &lt;= 10.575 milliseconds (cumulative count 150058)</span></span>
<span class="line"><span>87.500% &lt;= 11.359 milliseconds (cumulative count 175174)</span></span>
<span class="line"><span>93.750% &lt;= 11.943 milliseconds (cumulative count 187533)</span></span>
<span class="line"><span>96.875% &lt;= 12.575 milliseconds (cumulative count 193764)</span></span>
<span class="line"><span>98.438% &lt;= 13.359 milliseconds (cumulative count 196889)</span></span>
<span class="line"><span>99.219% &lt;= 14.447 milliseconds (cumulative count 198442)</span></span>
<span class="line"><span>99.609% &lt;= 16.703 milliseconds (cumulative count 199219)</span></span>
<span class="line"><span>99.805% &lt;= 22.671 milliseconds (cumulative count 199610)</span></span>
<span class="line"><span>99.902% &lt;= 29.151 milliseconds (cumulative count 199805)</span></span>
<span class="line"><span>99.951% &lt;= 37.023 milliseconds (cumulative count 199903)</span></span>
<span class="line"><span>99.976% &lt;= 40.735 milliseconds (cumulative count 199954)</span></span>
<span class="line"><span>99.988% &lt;= 57.535 milliseconds (cumulative count 199976)</span></span>
<span class="line"><span>99.994% &lt;= 58.879 milliseconds (cumulative count 199988)</span></span>
<span class="line"><span>99.997% &lt;= 59.167 milliseconds (cumulative count 199994)</span></span>
<span class="line"><span>99.998% &lt;= 59.327 milliseconds (cumulative count 199997)</span></span>
<span class="line"><span>99.999% &lt;= 59.423 milliseconds (cumulative count 199999)</span></span>
<span class="line"><span>100.000% &lt;= 59.487 milliseconds (cumulative count 200000)</span></span>
<span class="line"><span>100.000% &lt;= 59.487 milliseconds (cumulative count 200000)</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># 每增长1毫秒时，统计请求完成的百分比分布</span></span>
<span class="line"><span>Cumulative distribution of latencies:</span></span>
<span class="line"><span>0.000% &lt;= 0.103 milliseconds (cumulative count 0)</span></span>
<span class="line"><span>3.771% &lt;= 6.103 milliseconds (cumulative count 7542)</span></span>
<span class="line"><span>17.601% &lt;= 7.103 milliseconds (cumulative count 35202)</span></span>
<span class="line"><span>33.712% &lt;= 8.103 milliseconds (cumulative count 67423)</span></span>
<span class="line"><span>50.333% &lt;= 9.103 milliseconds (cumulative count 100666)</span></span>
<span class="line"><span>67.126% &lt;= 10.103 milliseconds (cumulative count 134252)</span></span>
<span class="line"><span>83.764% &lt;= 11.103 milliseconds (cumulative count 167528)</span></span>
<span class="line"><span>94.845% &lt;= 12.103 milliseconds (cumulative count 189690)</span></span>
<span class="line"><span>98.084% &lt;= 13.103 milliseconds (cumulative count 196168)</span></span>
<span class="line"><span>99.059% &lt;= 14.103 milliseconds (cumulative count 198117)</span></span>
<span class="line"><span>99.413% &lt;= 15.103 milliseconds (cumulative count 198825)</span></span>
<span class="line"><span>99.559% &lt;= 16.103 milliseconds (cumulative count 199118)</span></span>
<span class="line"><span>99.636% &lt;= 17.103 milliseconds (cumulative count 199272)</span></span>
<span class="line"><span>99.669% &lt;= 18.111 milliseconds (cumulative count 199339)</span></span>
<span class="line"><span>99.701% &lt;= 19.103 milliseconds (cumulative count 199401)</span></span>
<span class="line"><span>99.737% &lt;= 20.111 milliseconds (cumulative count 199474)</span></span>
<span class="line"><span>99.769% &lt;= 21.103 milliseconds (cumulative count 199538)</span></span>
<span class="line"><span>99.788% &lt;= 22.111 milliseconds (cumulative count 199577)</span></span>
<span class="line"><span>99.816% &lt;= 23.103 milliseconds (cumulative count 199633)</span></span>
<span class="line"><span>99.835% &lt;= 24.111 milliseconds (cumulative count 199671)</span></span>
<span class="line"><span>99.852% &lt;= 25.103 milliseconds (cumulative count 199703)</span></span>
<span class="line"><span>99.863% &lt;= 26.111 milliseconds (cumulative count 199726)</span></span>
<span class="line"><span>99.874% &lt;= 27.103 milliseconds (cumulative count 199748)</span></span>
<span class="line"><span>99.889% &lt;= 28.111 milliseconds (cumulative count 199778)</span></span>
<span class="line"><span>99.902% &lt;= 29.103 milliseconds (cumulative count 199804)</span></span>
<span class="line"><span>99.913% &lt;= 30.111 milliseconds (cumulative count 199827)</span></span>
<span class="line"><span>99.934% &lt;= 31.103 milliseconds (cumulative count 199868)</span></span>
<span class="line"><span>99.938% &lt;= 32.111 milliseconds (cumulative count 199877)</span></span>
<span class="line"><span>99.940% &lt;= 34.111 milliseconds (cumulative count 199880)</span></span>
<span class="line"><span>99.945% &lt;= 35.103 milliseconds (cumulative count 199890)</span></span>
<span class="line"><span>99.951% &lt;= 36.127 milliseconds (cumulative count 199902)</span></span>
<span class="line"><span>99.952% &lt;= 37.119 milliseconds (cumulative count 199904)</span></span>
<span class="line"><span>99.957% &lt;= 38.111 milliseconds (cumulative count 199915)</span></span>
<span class="line"><span>99.964% &lt;= 39.103 milliseconds (cumulative count 199928)</span></span>
<span class="line"><span>99.972% &lt;= 40.127 milliseconds (cumulative count 199943)</span></span>
<span class="line"><span>99.980% &lt;= 41.119 milliseconds (cumulative count 199960)</span></span>
<span class="line"><span>99.981% &lt;= 42.111 milliseconds (cumulative count 199961)</span></span>
<span class="line"><span>99.984% &lt;= 43.103 milliseconds (cumulative count 199967)</span></span>
<span class="line"><span>99.984% &lt;= 57.119 milliseconds (cumulative count 199969)</span></span>
<span class="line"><span>99.990% &lt;= 58.111 milliseconds (cumulative count 199981)</span></span>
<span class="line"><span>99.996% &lt;= 59.103 milliseconds (cumulative count 199993)</span></span>
<span class="line"><span>100.000% &lt;= 60.127 milliseconds (cumulative count 200000)</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 总结</span></span>
<span class="line"><span>Summary:</span></span>
<span class="line"><span>	# 吞吐量 ：8178.96请求/秒</span></span>
<span class="line"><span>  throughput summary: 8178.96 requests per second</span></span>
<span class="line"><span>  latency summary (msec):</span></span>
<span class="line"><span>          avg       min       p50       p95       p99       max</span></span>
<span class="line"><span>        9.171     5.152     9.087    12.135    14.007    59.487</span></span>
<span class="line"><span>        </span></span>
<span class="line"><span>	# avg：200000个请求的平均耗时为9.171毫秒</span></span>
<span class="line"><span>	# min：请求一次最小花费时间为5.152毫秒</span></span>
<span class="line"><span>	# p50、p95、p99：表示50%、95%、99%的请求，花费的平均耗时</span></span>
<span class="line"><span>	# max：请求一次最大花费时间为59.487毫秒</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>指定</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -t 指定测试的命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-benchmark</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> lpush,sadd</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -n</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 200000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># -q 输出精简版报告=&gt; 请求数/毫秒</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="redis主从集群" tabindex="-1">Redis主从集群 <a class="header-anchor" href="#redis主从集群" aria-label="Permalink to &quot;Redis主从集群&quot;">​</a></h2><p>Redis 的主从集群是<strong>一主多从</strong>的读写分离集群</p><p>集群中的<strong>Master 节点负责处理客户端的读写请求</strong>，而 <strong>Slave 节点仅能处理客户端的读请求</strong></p><p>只所以要将集群搭建为读写分离模式，主要原因是：对于数据库集群，写操作压力一般都较小，压力大多数来自于读操作请求。所以，只有一个节点负责处理写操作请求即可</p><h3 id="伪集群搭建与配置" tabindex="-1">伪集群搭建与配置 <a class="header-anchor" href="#伪集群搭建与配置" aria-label="Permalink to &quot;伪集群搭建与配置&quot;">​</a></h3><p>Redis采用单线程 IO 模型时，在多核主机中为了提高处理器的利用率，一般会在一个主机中安装多台 Redis，这就称为构建Redis 主从伪集群。</p><p>下面要搭建的读写分离伪集群包含一个 Master 与两个 Slave。它们的端口号分别是：6380、6381、6382</p><p><strong>公共配置</strong></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在redis目录下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">//修改公共文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 开启密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">requirepass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> hedaodao</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  #</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 做为slave时，连接的master的密码</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">masterauth</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">master-passwor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">d</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 因为集群中的master一点宕机下线，会有其他的slave升级为master。所以集群中的所有哦redis实例的masterauth和requirepass需保持一致</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231022004117%20.png" alt="image-20231022004116544"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl-disable-tcp-nodelay</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # disable+nodelay 双重否定，所以yes是有延迟，no是无延迟</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 设置为yes，就会使用Nagle算法，主从同步数据时不会立即发送tcp包，而是达到一定的数据量才发送一个tcp包，这样避免了频繁发送包（每个包都携带头尾信息，频发发生浪费带宽）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 如果主从复制数据量非常大、有多级Redis，就会很快达到指定的数据量，这种情况下即使设置为yes，延迟也会很小，这时比较适合yes</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p><strong>各个Redis配置</strong></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 不存在的文件，会新建</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis6380.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 添加下面配置，作为启动在6380端口的redis的配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 引入公共配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定pid文件存储位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/redis_6380.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rdb文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dbfilename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dump6380.rdb</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># aof文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendfilename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> appendonly6380.aof</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志文件（该配置并不会自动创建文件，需要自己建好文件，再启动redis）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># logfile logs/access6380.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">63</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当master宕机,选举slave为master是会参照该属性.越小优先级越高,为0则不能晋升为master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replica-priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>继续创建6381、6382配置文件</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">%s/6380/6380</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 将文件中的6380替换为6381</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>启动三个redis服务</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-server</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redisxxxx.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 6380、6381、6382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ps</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> aux</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 查看是否启动成功</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>客户端连接redis服务</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> xxxx</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 6380、6381、6382 可通过端口连接到不同实例</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> info replication </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 在交互模式下查询，主从复制信息</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role:master</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 每个实例默认都是master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connected_slaves:0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 没有slave</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid:00cc23da2a5c0bf376b0f50469d0f1669ded064f</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid2:0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_repl_offset:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_active:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_first_byte_offset:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_histlen:0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----------------建立主从关系-------------------</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#------6381、6382 这两台作为slave--------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">slaveof 127.0.0.1 6380 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#添加6380为master节点</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role:slave</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 角色变为slave</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_host:127.0.0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 自己的master地址和端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_port:6380</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_link_status:up</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # up代表连接正常，如果master挂了，这里就是down了</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_last_io_seconds_ago:9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_sync_in_progress:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_read_repl_offset:560</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_repl_offset:560</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_priority:20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_read_only:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replica_announced:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connected_slaves:0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 即使是slave，也会有下一级的slave。后面会讲到redis的多级结构</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid:e0289d3727266ab15a6780fd49857fc3e7ce58a4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 集群中的master节点的id</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid2:0000000000000000000000000000000000000000</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 如果集群中的maser易主了，master_replid就会变成新master的id。master_replid2存的是历史上一个master的id，这里的`00000....`表示，这个集群master并未易主</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_repl_offset:560</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_first_byte_offset:15</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_histlen:546</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#------6380 作为master--------</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">info replication</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role:master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connected_slaves:2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 可以查到两个slave节点信息。offset是向slave同步的数据量，slave节点的slave_repl_offset字段是接收的数据量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=127.0.0.1,port=6381,state=online,offset=42,lag=0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave1:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=127.0.0.1,port=6382,state=online,offset=42,lag=1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid:e0289d3727266ab15a6780fd49857fc3e7ce58a4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid2:0000000000000000000000000000000000000000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_repl_offset:42</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">second_repl_offset:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_first_byte_offset:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_histlen:42</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><hr><p>redis的集群的多级结构</p><p>如果存在大量的二级slave，对应主节点的复制压力很大。这时候就可以采用多级结构，两个以及slave，这两个slave在复制到更多的slave中</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231022154518%20.png" alt="image-20231022154517598"></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 连接准备做三级slave的redis。添加二级节点作为master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slaveof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 二级节点地址</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 二级节点端口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="容灾处理" tabindex="-1">容灾处理 <a class="header-anchor" href="#容灾处理" aria-label="Permalink to &quot;容灾处理&quot;">​</a></h3><p>如果master宕机。slave如何晋升为master</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231022155439%20.png" alt="image-20231022155438797"></p><ul><li><p>手动</p><p>例如把slave1节点执行下面命令，就会晋升为master节点</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slaveof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> one</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>注意：slave2节点也必须手动加入到新的master节点（原来的slave1）</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>slaveof slave1地址 slave1端口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>这时候，原来的master重启了，虽然重新启动的redis默认情况都是master，但是已经和原来的集群分离了。必须加入新的master</p><div class="language- vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>slaveof slave1地址 slave1端口</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>哨兵机制（sentinel）</p><p>从Redis2.6开始提供了高可用的解决方案—— Sentinel 哨兵机制。</p><p>即，在集群中再引入一个节点，该节点充当 Sentinel 哨兵，用于监视 Master 的运行状态，并在 Master 宕机后自动指定一个 Slave 作为新的 Master 若使用一个哨兵，该哨兵发生宕机，整个集群就会因为无法选出master而瘫痪。所以一般会创建一个哨兵集群 集群中每个哨兵都会定时会向 Master 发送心跳，如果 Master 在有效时间内向它们都进行了响应，则说明 Master 是“活着的”。如果有 quorum 个哨兵没有收到响应，那么就认为 Master 已经宕机，然后会将原来的某一个 Slave晋升为 Master</p><p><strong>配置sentinel</strong></p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis安装目录下 sentinel.conf 是sentinel的配置文件</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentinel.conf</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> cluster/</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>sentinel配置文件完整版（用 ----- 加入自己的翻译，或对英文的注解）</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example sentinel.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># By default protected mode is disabled in sentinel mode. Sentinel is reachable</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># from interfaces different than localhost. Make sure the sentinel instance is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># protected from the outside world via firewalling or other means.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 保护模式，默认关闭</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">protected-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># port &lt;sentinel-port&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The port that this sentinel instance will run on</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 哨兵运行端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26379</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># By default Redis Sentinel does not run as a daemon. Use &#39;yes&#39; if you need it.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note that Redis will write a pid file in /var/run/redis-sentinel.pid when</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># daemonized.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 是否以守护进程运行哨兵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">daemonize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When running daemonized, Redis Sentinel writes a pid file in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># /var/run/redis-sentinel.pid by default. You can specify a custom pid file</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># location here.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/redis-sentinel.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Specify the server verbosity level.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This can be one of:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># debug (a lot of information, useful for development/testing)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># verbose (many rarely useful info, but not a mess like the debug level)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># notice (moderately verbose, what you want in production probably)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># warning (only very important / critical messages are logged)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># nothing (nothing is logged)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志等级</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">loglevel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> notice</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Specify the log file name. Also the empty string can be used to force</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel to log on the standard output. Note that if you use standard</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># output for logging but daemonize, logs will be sent to /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># To enable logging to the system logger, just set &#39;syslog-enabled&#39; to yes,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># and optionally update the other syslog parameters to suit your needs.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># syslog-enabled no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Specify the syslog identity.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># syslog-ident sentinel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Specify the syslog facility. Must be USER or between LOCAL0-LOCAL7.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># syslog-facility local0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel announce-ip &lt;ip&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel announce-port &lt;port&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The above two configuration directives are useful in environments where,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># because of NAT, Sentinel is reachable from outside via a non-local address.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When announce-ip is provided, the Sentinel will claim the specified IP address</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># in HELLO messages used to gossip its presence, instead of auto-detecting the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># local address as it usually does.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Similarly when announce-port is provided and is valid and non-zero, Sentinel</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># will announce the specified TCP port.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The two options don&#39;t need to be used together, if only announce-ip is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># provided, the Sentinel will announce the specified IP and the server port</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># as specified by the &quot;port&quot; option. If only announce-port is provided, the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel will announce the auto-detected local IP and the specified port.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel announce-ip 1.2.3.4</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># dir &lt;working-directory&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Every long running process should have a well-defined working directory.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For Redis Sentinel to chdir to /tmp at startup is the simplest thing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for the process to don&#39;t interfere with administrative tasks such as</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># unmounting filesystems.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> -----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 哨兵临时文件放置的文件夹</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /tmp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Tells Sentinel to monitor this master, and to consider it in O_DOWN</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (Objectively Down) state only if at least &lt;quorum&gt; sentinels agree.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -----至少有quorum个哨兵主观认定master宕机，才能判断master节点宕机</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note that whatever is the ODOWN quorum, a Sentinel will require to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># be elected by the majority of the known Sentinels in order to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># start a failover, so no failover can be performed in minority.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ------这句比较难理解。实际上需要在所有哨兵中，选出一个多数派（分为两派，认定master宕机、认定master未宕机的）来执行故障转移任务（就是切换redis的主从关系），如果quorum设置的少于哨兵总数的一半，那选出的哨兵一定是认定master未宕机的。所以，quorum必须设置为一半以上</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Replicas are auto-discovered, so you don&#39;t need to specify replicas in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># any way. Sentinel itself will rewrite this configuration file adding</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the replicas using additional configuration options.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Also note that the configuration file is rewritten when a</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># replica is promoted to master.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note: master name should not include special characters or spaces.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The valid charset is A-z 0-9 and the three characters &quot;.-_&quot;.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这个配置很重要，仔细阅读上面的介绍</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  -----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 这个配置是设置哨兵监听当前的master的信息，对于其他副本实例（slave），哨兵会自动检测到</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  			下面会被这个文件作为公共的哨兵配置文件，这条配置会在各个哨兵配置文件中重写，所以，这里要注释掉</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set the password to use to authenticate with the master and replicas.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Useful if there is a password set in the Redis instances to monitor.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Note that the master password is also used for replicas, so it is not</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master和replicas实例都需要设置相同的密码</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># possible to set a different password in masters and replicas instances</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># if you want to be able to monitor these instances with Sentinel.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># However you can have Redis instances without the authentication enabled</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># mixed with Redis instances requiring the authentication (as long as the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># password set is the same for all the instances requiring the password) as</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the AUTH command will have no effect in Redis instances with authentication switched off.（授权被关闭）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 支持</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 设置密码和未设置密码的redis实例混合在一起组成集群（注意，设置密码的必须保持密码一致）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel auth-user &lt;master-name&gt; &lt;username&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This is useful in order to authenticate to instances having ACL capabilities,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># that is, running Redis 6.0 or greater. When just auth-pass is provided the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel instance will authenticate to Redis using the old &quot;AUTH &lt;pass&gt;&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># method. When also an username is provided, it will use &quot;AUTH &lt;user&gt; &lt;pass&gt;&quot;.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In the Redis servers side, the ACL to provide just minimal access to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel instances, should be configured along the following lines:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#     user sentinel-user &gt;somepassword +client +subscribe +publish \</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#                        +ping +info +multi +slaveof +config +client +exec on</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Number of milliseconds the master (or any attached replica or sentinel) should</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># be unreachable (as in, not acceptable reply to PING, continuously, for the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># specified period) in order to consider it in S_DOWN state (Subjectively</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Down).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Default is 30 seconds.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	---------哨兵30秒未收到响应，则该哨兵认为宕机</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> down-after-milliseconds</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 30000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># IMPORTANT NOTE: starting with Redis 6.2 ACL capability is supported for</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel mode, please refer to the Redis website https://redis.io/topics/acl</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for more details.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sentinel&#39;s ACL users are defined in the following format:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   user &lt;username&gt; ... acl rules ...</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For example:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   user worker +@admin +@connection ~* on &gt;ffa9203c493aa99</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># For more information about ACL configuration please refer to the Redis</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># website at https://redis.io/topics/acl and redis server configuration </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># template redis.conf.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ACL LOG</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The ACL Log tracks failed commands and authentication events associated</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># with ACLs. The ACL Log is useful to troubleshoot failed commands blocked </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># by ACLs. The ACL Log is stored in memory. You can reclaim memory with </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ACL LOG RESET. Define the maximum entry length of the ACL Log below.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acllog-max-len</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 128</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Using an external ACL file</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Instead of configuring users here in this file, it is possible to use</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># a stand-alone file just listing users. The two methods cannot be mixed:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># if you configure users here and at the same time you activate the external</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ACL file, the server will refuse to start.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The format of the external ACL user file is exactly the same as the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># format that is used inside redis.conf to describe users.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># aclfile /etc/redis/sentinel-users.acl</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># requirepass &lt;password&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can configure Sentinel itself to require a password, however when doing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># so Sentinel will try to authenticate with the same password to all the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># other Sentinels. So you need to configure all your Sentinels in a given</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># group with the same &quot;requirepass&quot; password. Check the following documentation</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># for more info: https://redis.io/topics/sentinel</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># IMPORTANT NOTE: starting with Redis 6.2 &quot;requirepass&quot; is a compatibility</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># layer on top of the ACL system. The option effect will be just setting</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the password for the default user. Clients will still authenticate using</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># AUTH &lt;password&gt; as usually, or more explicitly with AUTH default &lt;password&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># if they follow the new protocol: both will work.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># New config files are advised to use separate authentication control for</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># incoming connections (via ACL), and for outgoing connections (via</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel-user and sentinel-pass) </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The requirepass is not compatible with aclfile option and the ACL LOAD</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># command, these will cause requirepass to be ignored.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel sentinel-user &lt;username&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You can configure Sentinel to authenticate with other Sentinels with specific</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># user name. </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel sentinel-pass &lt;password&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The password for Sentinel to authenticate with other Sentinels. If sentinel-user</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># is not configured, Sentinel will use &#39;default&#39; user with sentinel-pass to authenticate.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel parallel-syncs &lt;master-name&gt; &lt;numreplicas&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># How many replicas we can reconfigure to point to the new replica simultaneously</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># during the failover. Use a low number if you use the replicas to serve query</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to avoid that all the replicas will be unreachable at about the same</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># time while performing the synchronization with the master.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  ---------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 原master宕机。进行故障转移时，这里用来设置几个副本同时把数据复制到新选的master中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  					注意：复制时，新maser无法提供读写服务，同步中的slave副本是无法进行对外读服务的，所以切记不可设置为所有的slave个数</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parallel-syncs</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Specifies the failover timeout in milliseconds. It is used in many ways:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - The time needed to re-start a failover after a previous failover was</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   already tried against the same master by a given Sentinel, is two</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   times the failover timeout. </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 哨兵进行故障转移时如果失败，重新进行故障转移的超时时间为上一次的两倍：</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">（默认3分钟）=6分钟</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - The time needed for a replica replicating to a wrong master according</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   to a Sentinel current configuration, to be forced to replicate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   with the right master, is exactly the failover timeout (counting since</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   the moment a Sentinel detected the misconfiguration).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-----</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 这里的wrong</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master指的是宕机的master，right</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master是新的master。因为新master被选举后，slave的配置文件中还是配置的旧的master，文件被哨兵变更为新的master的时间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - The time needed to cancel a failover that is already in progress but</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   did not produced any configuration change (SLAVEOF NO ONE yet not</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   acknowledged by the promoted replica).</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 哨兵选择晋升slave后，决定取消晋升的超时时间</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># - The maximum time a failover in progress waits for all the replicas to be</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   reconfigured as replicas of the new master. However even after this time</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   the replicas will be reconfigured by the Sentinels anyway, but not with</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#   the exact parallel-syncs progression as specified.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">-------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 故障转移的最大时间，但是即使超过了这个时间，哨兵仍然会继续做转移，只不过哨兵可能会增加sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> parallel-syncs指定的同步的数量</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Default is 3 minutes.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">	---------</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> failover-timeout</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 180000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SCRIPTS EXECUTION</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel notification-script and sentinel reconfig-script are used in order</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to configure scripts that are called to notify the system administrator</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># or to reconfigure clients after a failover. The scripts are executed</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># with the following rules for error handling:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If script exits with &quot;1&quot; the execution is retried later (up to a maximum</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># number of times currently set to 10).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If script exits with &quot;2&quot; (or an higher value) the script execution is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># not retried.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># If script terminates because it receives a signal the behavior is the same</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># as exit code 1.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># A script has a maximum running time of 60 seconds. After this limit is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># reached the script is terminated with a SIGKILL and the execution retried.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># NOTIFICATION SCRIPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Call the specified notification script for any sentinel event that is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># generated in the WARNING level (for instance -sdown, -odown, and so forth).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This script should notify the system administrator via email, SMS, or any</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># other messaging system, that there is something wrong with the monitored</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Redis systems.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The script is called with just two arguments: the first is the event type</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># and the second the event description.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The script must exist and be executable in order for sentinel to start if</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># this option is provided.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel notification-script mymaster /var/redis/notify.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># CLIENTS RECONFIGURATION SCRIPT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When the master changed because of a failover a script can be called in</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># order to perform application-specific tasks to notify the clients that the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># configuration has changed and the master is at a different address.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The following arguments are passed to the script:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;state&gt; is currently always &quot;start&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># &lt;role&gt; is either &quot;leader&quot; or &quot;observer&quot;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># The arguments from-ip, from-port, to-ip, to-port are used to communicate</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># the old address of the master and the new address of the elected replica</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (now a master).</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># This script should be resistant to multiple invocations.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Example:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SECURITY</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># By default SENTINEL SET will not be able to change the notification-script（通知脚本）</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># and client-reconfig-script（故障转移结束之后触发脚本） at runtime. This avoids a trivial security issue</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># where clients can set the script to anything and trigger a failover in order</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to get the program executed.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">--------</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes表示禁止在运行时重新配置</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> Sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 的脚本</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> deny-scripts-reconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># REDIS COMMANDS RENAMING (DEPRECATED)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># WARNING: avoid using this option if possible, instead use ACLs.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Sometimes the Redis server has certain commands, that are needed for Sentinel</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to work correctly, renamed to unguessable strings. This is often the case</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># of CONFIG and SLAVEOF in the context of providers that provide Redis as</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># a service, and don&#39;t want the customers to reconfigure the instances outside</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># of the administration console.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In such case it is possible to tell Sentinel to use different command names</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># instead of the normal ones. For example if the master &quot;mymaster&quot;, and the</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># associated replicas, have &quot;CONFIG&quot; all renamed to &quot;GUESSME&quot;, I could use:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SENTINEL rename-command mymaster CONFIG GUESSME</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># After such configuration is set, every time Sentinel would use CONFIG it will</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># use GUESSME instead. Note that there is no actual need to respect the command</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># case, so writing &quot;config guessme&quot; is the same in the example above.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SENTINEL SET can also be used in order to perform this configuration at runtime.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># In order to set a command back to its original name (undo the renaming), it</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># is possible to just rename a command to itself:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># SENTINEL rename-command mymaster CONFIG CONFIG</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># HOSTNAMES SUPPORT</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Normally Sentinel uses only IP addresses and requires SENTINEL MONITOR</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to specify an IP address. Also, it requires the Redis replica-announce-ip</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># keyword to specify only IP addresses.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># You may enable hostnames support by enabling resolve-hostnames. Note</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># that you must make sure your DNS is configured properly and that DNS</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># resolution does not introduce very long delays.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SENTINEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> resolve-hostnames</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When resolve-hostnames is enabled, Sentinel still uses IP addresses</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># when exposing instances to users, configuration files, etc. If you want</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># to retain the hostnames when announced, enable announce-hostnames below.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SENTINEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> announce-hostnames</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># When master_reboot_down_after_period is set to 0, Sentinel does not fail over</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># when receiving a -LOADING response from a master. This was the only supported</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># behavior before version 7.0.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Otherwise, Sentinel will use this value as the time (in ms) it is willing to</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># accept a -LOADING response after a master has been rebooted, before failing</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># over.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">SENTINEL</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> master-reboot-down-after-period</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br><span class="line-number">295</span><br><span class="line-number">296</span><br><span class="line-number">297</span><br><span class="line-number">298</span><br><span class="line-number">299</span><br><span class="line-number">300</span><br><span class="line-number">301</span><br><span class="line-number">302</span><br><span class="line-number">303</span><br><span class="line-number">304</span><br><span class="line-number">305</span><br><span class="line-number">306</span><br><span class="line-number">307</span><br><span class="line-number">308</span><br><span class="line-number">309</span><br><span class="line-number">310</span><br><span class="line-number">311</span><br><span class="line-number">312</span><br><span class="line-number">313</span><br><span class="line-number">314</span><br><span class="line-number">315</span><br><span class="line-number">316</span><br><span class="line-number">317</span><br><span class="line-number">318</span><br><span class="line-number">319</span><br><span class="line-number">320</span><br><span class="line-number">321</span><br><span class="line-number">322</span><br><span class="line-number">323</span><br><span class="line-number">324</span><br><span class="line-number">325</span><br><span class="line-number">326</span><br><span class="line-number">327</span><br><span class="line-number">328</span><br><span class="line-number">329</span><br><span class="line-number">330</span><br><span class="line-number">331</span><br><span class="line-number">332</span><br><span class="line-number">333</span><br><span class="line-number">334</span><br><span class="line-number">335</span><br><span class="line-number">336</span><br><span class="line-number">337</span><br><span class="line-number">338</span><br><span class="line-number">339</span><br><span class="line-number">340</span><br><span class="line-number">341</span><br><span class="line-number">342</span><br><span class="line-number">343</span><br><span class="line-number">344</span><br><span class="line-number">345</span><br><span class="line-number">346</span><br><span class="line-number">347</span><br><span class="line-number">348</span><br><span class="line-number">349</span><br><span class="line-number">350</span><br><span class="line-number">351</span><br><span class="line-number">352</span><br><span class="line-number">353</span><br><span class="line-number">354</span><br><span class="line-number">355</span><br><span class="line-number">356</span><br><span class="line-number">357</span><br><span class="line-number">358</span><br><span class="line-number">359</span><br><span class="line-number">360</span><br><span class="line-number">361</span><br><span class="line-number">362</span><br><span class="line-number">363</span><br><span class="line-number">364</span><br><span class="line-number">365</span><br><span class="line-number">366</span><br><span class="line-number">367</span><br><span class="line-number">368</span><br><span class="line-number">369</span><br><span class="line-number">370</span><br><span class="line-number">371</span><br><span class="line-number">372</span><br><span class="line-number">373</span><br><span class="line-number">374</span><br><span class="line-number">375</span><br><span class="line-number">376</span><br><span class="line-number">377</span><br><span class="line-number">378</span><br><span class="line-number">379</span><br><span class="line-number">380</span><br></div></div><p>cluster文件夹下添加三个哨兵配置文件</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># sentinel（哨兵）实例 ，26380、26381、26382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 新建26380哨兵实例的文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentinel26380.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 文件加入如下配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentinel.conf</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 引入公共配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/sentinel_26380.pid</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26380</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # myMaster可以随便起个名字，用来代表master节点。192.168.174.120 6380是master的ip和端口。 2表示只有有两个哨兵任务master宕机，则判断master已宕机</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#logfile access26380.log  # 日志</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>与配置三个redis实例相似，新建三个配置文件即可</p><p>启动哨兵</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 启动哨兵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis-sentinel是redis-server的别名，也可以使用redis-server启动哨兵</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis-server 哨兵配置文件 --sentinel</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 哨兵配置文件</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 查询哨兵集群的信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis-sentinel的本质就是redis-server，所以也可以使用redis-cli连接</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 哨兵端口</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> info</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentinel</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 使用任意一个哨兵的端口即可</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># redis-cli -p 26380 info sentinel # 查询哨兵集群信息</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 输出：</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_masters:1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 监控了1个master（哨兵是可以监控多个集群的）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_tilt:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_tilt_since_seconds:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_running_scripts:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_scripts_queue_length:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel_simulate_failure_flags:0</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#  哨兵配置文件中给master节点起的名字就是myMaster</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#  address是master的ip和端口</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#  slaves个数是2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#  sentinels（哨兵）个数是3</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master0:name</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=myMaster,status=ok,address=192.168.174.120:6380,slaves=2,sentinels=3</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>哨兵启动后，我们查看26380端口的哨兵（每个启动的哨兵配置文件都变化了）</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/run/sentinel_26380.pid&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26380</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#logfile access26380.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">protected-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">latency-tracking-info-percentiles</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 99</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 99.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/tmp&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nopass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sanitize-payload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> +@all</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> c05e7f92cd2f0ace8b5e1a7b266386497b9a53b8</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config-epoch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> leader-epoch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6379</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> config-epoch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> leader-epoch</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> mymaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> current-epoch</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----- redis的两个slave</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-replica</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6381</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 本机的ip，所以与下一行的127.0.0.1是一样的</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-replica</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6381</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-replica</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-replica</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 127.0.0.1</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6382</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># ----- 两个哨兵</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26381</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> d9b962d71ad736d0472d558138be1410eaf4f3a7</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> known-sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 26382</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 669c77662921529702abb9cc14017407be483583</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>对于redis的master（端口6380）的配置文件没有变化</p><p>但是两个slave的配置文件变化了</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 添加下面配置，作为启动在6381端口的redis的配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 引入公共配置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">include</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 指定pid文件存储位置</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pidfile</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/var/run/redis_6381.pid&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">port</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6381</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># rdb文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dbfilename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;dump6381.rdb&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># aof文件名</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendfilename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;appendonly6381.aof&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 日志文件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#logfile logs/access6381.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 当master宕机,选举slave为master是会参照该属性.越小优先级越高,为0则不能晋升为master</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replica-priority</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-------------------------------------多了下面这些行</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Generated by CONFIG REWRITE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">daemonize</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dir</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;/opt/apps/redis/cluster&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">latency-tracking-info-percentiles</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 50</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 99</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 99.9</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">protected-mode</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">appendonly</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> yes</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3600</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 300</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 100</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">save</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 60</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">aof-load-truncated</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> no</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replicaof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 指明当前节点是192.168.174.120 6380的slave</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> on</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nopass</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sanitize-payload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ~</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> +@all</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div><p>模拟master（6380端口）宕机</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">redis-cli</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -p</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shutdown</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><p>现象：</p><ul><li><p>观察哨兵，会打印一条日志。表示切换master为6381端口</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">switch-master</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6380</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6381</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div></li><li><p>哨兵配置会自动变为</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 这里原来是6380，但是现在宕机了。自动变为新的master地址</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sentinel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> monitor</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> myMaster</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 192.168.174.120</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 6381</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li><li><p>redis集群信息</p><div class="language-shell vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">redis-cli -p 6381 info replication</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 虽然这里6381还是slave，但是master的IP和端口已经变成了6381了</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 类似于多级结构</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">role:slave</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_host:192.168.174.120</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_port:6381</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_link_status:down</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_last_io_seconds_ago:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_sync_in_progress:0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_read_repl_offset:498326</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_repl_offset:498326</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_link_down_since_seconds:-1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_priority:20</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave_read_only:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">replica_announced:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">connected_slaves:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">slave0:ip</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">=192.168.174.120,port=6382,state=online,offset=498326,lag=0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_failover_state:no-failover</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid:ea12c952478fb3eb0ac09b8d6f8c0b37eb3a9c9c</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_replid2:4bf01980a3f7897482cb0b31dff22544ffc29f39</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">master_repl_offset:498326</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">second_repl_offset:494175</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_active:1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_size:1048576</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_first_byte_offset:15</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repl_backlog_histlen:498312</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div></li></ul></li></ul><h3 id="主从复制过程" tabindex="-1">主从复制过程 <a class="header-anchor" href="#主从复制过程" aria-label="Permalink to &quot;主从复制过程&quot;">​</a></h3><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Essay/20231022193756%20.png" alt="image-20231022193756192"></p></div></div></main><footer class="VPDocFooter" data-v-16c4b07c data-v-2df7eed5><!--[--><!--]--><div class="edit-info" data-v-2df7eed5><!----><div class="last-updated" data-v-2df7eed5><p class="VPLastUpdated" data-v-2df7eed5 data-v-6df67869>最后更新时间: <time datetime="2024-07-10T03:15:01.000Z" data-v-6df67869></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter" data-v-b4698e35 data-v-e1a77434><div class="container" data-v-e1a77434><p class="message" data-v-e1a77434>Released under the MIT License.</p><p class="copyright" data-v-e1a77434>Copyright © 2019-present Hedaodao</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"api-examples.md\":\"Plsv2s66\",\"docs_dealarticle_事务性写作方案.md\":\"CgC7OTED\",\"docs_frontbasic_css技术精炼.md\":\"BVDEfE05\",\"docs_frontbasic_js重刷笔记.md\":\"Prte6aDC\",\"docs_frontbasic_nest.md\":\"Cx-smW2W\",\"docs_frontbasic_node-web开发.md\":\"41glsyNa\",\"docs_frontbasic_rxjs.md\":\"BiOTiXP8\",\"docs_frontbasic_ts学习笔记.md\":\"CqJF9lHX\",\"docs_frontbasic_vue2重刷笔记.md\":\"C1eUJoAa\",\"docs_frontbasic_vue3原理.md\":\"o1MUqjTJ\",\"docs_frontbasic_vue3生态.md\":\"BtcuLBso\",\"docs_frontbasic_前端脚手架.md\":\"CYhg9i6K\",\"docs_frontbasic_前端调试.md\":\"fn_OCIf1\",\"docs_frontbasic_实现小程序框架.md\":\"_y1vPS8J\",\"docs_frontbasic_总结.md\":\"sLy5YzUL\",\"docs_frontbasic_随手记.md\":\"Dy6kmvn5\",\"docs_frontengineering_gulp自动化神器.md\":\"B64d59d3\",\"docs_frontengineering_npm应知应会.md\":\"o0On7gKv\",\"docs_frontengineering_vite.md\":\"Df5PZ-Kz\",\"docs_frontengineering_代码分析-ast.md\":\"DQ4gtc7x\",\"docs_frontengineering_项目配置.md\":\"BVPk-kw_\",\"docs_golang_goweb学习.md\":\"Dek4VwYu\",\"docs_golang_go学习笔记.md\":\"D0_gyl4k\",\"docs_golang_go实践.md\":\"CffZfng5\",\"docs_golang_go微服务.md\":\"_FdOJiwg\",\"docs_mobilebasic_flutter.md\":\"5G-oZ4i4\",\"docs_mobilebasic_鸿蒙.md\":\"DX70qo8C\",\"docs_otherlanguage_c__使用学习笔记.md\":\"wOTN7WlY\",\"docs_otherlanguage_docker.md\":\"D0coWXeD\",\"docs_otherlanguage_linux学习笔记.md\":\"DS9SkYxe\",\"docs_otherlanguage_mysql学习笔记.md\":\"DCXkcNf0\",\"docs_otherlanguage_nginx学习.md\":\"Dt0iIvxk\",\"docs_otherlanguage_python爬虫进阶学习笔记.md\":\"5GFOeZzm\",\"docs_otherlanguage_redis.md\":\"Bdnvjvty\",\"docs_otherlanguage_工业化搜索引擎.md\":\"BqQezovs\",\"docs_otherlanguage_面向对象设计的思考.md\":\"Bpball0T\",\"docs_otherlanguage_音视频基础.md\":\"dG3XFhKS\",\"docs_programbasic_git相关笔记.md\":\"KnCAdrD7\",\"docs_programbasic_https原理.md\":\"yTiOj5UJ\",\"docs_programbasic_leetcode刷题记录.md\":\"DjofiTcC\",\"docs_programbasic_常用服务端口.md\":\"BRz9yCIU\",\"docs_programtool_charles的学习笔记.md\":\"DciNE9ne\",\"docs_programtool_mac使用经验.md\":\"BioFAZkR\",\"docs_programtool_vscode使用指南.md\":\"BxI_36zx\",\"docs_programtool_webstorm.md\":\"DLvEX2oV\",\"index.md\":\"VbM3i6y5\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"何叨叨的个人博客\",\"description\":\"我的个人网站\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"https://heyingjiee.github.io/logo.png\",\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/heyingjiee\"}],\"outline\":{\"level\":[2,6],\"label\":\"文章大纲\"},\"nav\":[{\"text\":\"前端\",\"items\":[{\"text\":\"JS重刷笔记（持续更新）\",\"link\":\"/docs/frontBasic/JS重刷笔记.md\"},{\"text\":\"TS笔记（持续更新）\",\"link\":\"/docs/frontBasic/TS学习笔记.md\"},{\"text\":\"CSS笔记\",\"link\":\"/docs/frontBasic/CSS技术精炼.md\"},{\"text\":\"Vue笔记\",\"link\":\"/docs/frontBasic/Vue2重刷笔记.md\"},{\"text\":\"Nest笔记（持续更新）\",\"link\":\"/docs/frontBasic/Nest.md\"}]},{\"text\":\"移动端\",\"items\":[{\"text\":\"鸿蒙Next\",\"link\":\"/docs/mobileBasic/鸿蒙.md\"},{\"text\":\"Flutter（暂停更新）\",\"link\":\"/docs/mobileBasic/Flutter.md\"}]},{\"text\":\"Go语言\",\"items\":[{\"text\":\"Go 基础\",\"link\":\"/docs/golang/Go学习笔记.md\"},{\"text\":\"Go Web（持续更新）\",\"link\":\"/docs/golang/GoWeb学习.md\"},{\"text\":\"Go 微服务（持续更新）\",\"link\":\"/docs/golang/Go微服务.md\"}]},{\"text\":\"编程基础\",\"items\":[{\"text\":\"Git\",\"link\":\"/docs/programBasic/Git相关笔记.md\"},{\"text\":\"HTTPS原理\",\"link\":\"/docs/programBasic/HTTPS原理.md\"},{\"text\":\"Leetcode学习\",\"link\":\"/docs/programBasic/leetcode刷题记录.md\"},{\"text\":\"常用服务端口\",\"link\":\"/docs/programBasic/常用服务端口.md\"}]},{\"text\":\"其他语言\",\"items\":[{\"text\":\"Python爬虫\",\"link\":\"/docs/otherLanguage/python爬虫进阶学习笔记.md\"},{\"text\":\"C/C++基础\",\"link\":\"/docs/otherLanguage/c++使用学习笔记.md\"}]},{\"text\":\"其他技术\",\"items\":[{\"text\":\"Redis7\",\"link\":\"/docs/otherLanguage/Redis.md\"},{\"text\":\"Docker\",\"link\":\"/docs/otherLanguage/Docker.md\"},{\"text\":\"Nginx（待补充）\",\"link\":\"/docs/otherLanguage/Nginx学习.md\"},{\"text\":\"Linux基础\",\"link\":\"/docs/otherLanguage/Linux学习笔记.md\"}]},{\"text\":\"前端工程化\",\"items\":[{\"text\":\"前端项目配置\",\"link\":\"/docs/frontEngineering/项目配置.md\"},{\"text\":\"NPM应知应会\",\"link\":\"/docs/frontEngineering/NPM应知应会.md\"},{\"text\":\"Gulp自动化神器\",\"link\":\"/docs/frontEngineering/Gulp自动化神器.md\"},{\"text\":\"Vite\",\"link\":\"/docs/frontEngineering/Vite.md\"}]},{\"text\":\"工具\",\"items\":[{\"text\":\"WebStorm\",\"link\":\"/docs/programTool/WebStorm.md\"},{\"text\":\"Charles\",\"link\":\"/docs/programTool/Charles的学习笔记.md\"},{\"text\":\"Mac使用经验\",\"link\":\"/docs/programTool/Mac使用经验.md\"}]}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2019-present Hedaodao\"},\"lastUpdated\":{\"text\":\"最后更新时间\"},\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>