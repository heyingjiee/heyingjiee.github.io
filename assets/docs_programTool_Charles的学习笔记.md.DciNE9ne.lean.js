import{_ as e,c as o,a2 as p,o as t}from"./chunks/framework.CQii86iU.js";const d=JSON.parse('{"title":"charles的学习笔记","description":"","frontmatter":{},"headers":[],"relativePath":"docs/programTool/Charles的学习笔记.md","filePath":"docs/programTool/Charles的学习笔记.md","lastUpdated":1718292798000}'),s={name:"docs/programTool/Charles的学习笔记.md"};function i(r,a,c,l,g,h){return t(),o("div",null,a[0]||(a[0]=[p('<h1 id="charles的学习笔记" tabindex="-1">charles的学习笔记 <a class="header-anchor" href="#charles的学习笔记" aria-label="Permalink to &quot;charles的学习笔记&quot;">​</a></h1><h2 id="charles的原理" tabindex="-1">charles的原理 <a class="header-anchor" href="#charles的原理" aria-label="Permalink to &quot;charles的原理&quot;">​</a></h2><p>charles时一款<strong>代理</strong>抓包工具，即所有的请求经过charles，charles会捕获到数据</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108143439414%20.png" alt="image-20220108143439414"></p><h2 id="charles的功能" tabindex="-1">charles的功能 <a class="header-anchor" href="#charles的功能" aria-label="Permalink to &quot;charles的功能&quot;">​</a></h2><ul><li>支持Http/Https的代理</li><li>支持浏览控制【可以做一些弱网环境测试】</li><li>支持接口并发请求【可以用来做接口的性能测试】</li><li>支持重发网络请求</li><li>支持断点调试【在发送请求和接受返回时修改数据，可以在测试过程中构建一些异常的测试场景】</li></ul><h2 id="安装就激活教程" tabindex="-1">安装就激活教程 <a class="header-anchor" href="#安装就激活教程" aria-label="Permalink to &quot;安装就激活教程&quot;">​</a></h2><p><a href="https://www.charlesproxy.com/download/" target="_blank" rel="noreferrer">charles官网下载地址</a></p><p><a href="https://zhuanlan.zhihu.com/p/72138226" target="_blank" rel="noreferrer">安装并激活Charles</a></p><h2 id="界面介绍" tabindex="-1">界面介绍 <a class="header-anchor" href="#界面介绍" aria-label="Permalink to &quot;界面介绍&quot;">​</a></h2><p>下载后打开主界面（我这里下载的是v4.6.2版本）</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108150350055%20.png" alt="image-20220108150350055"></p><p>顶部导航栏图标含义</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108145014636%20.png" alt="image-20220108145014636"></p><p>左侧请求栏</p><p><strong>Structure</strong>表示按照域名展示请求</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108151118009%20.png" alt="image-20220108151118009"></p><p><strong>Sequence</strong>表示按照请求的时间展示请求</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108150844707%20.png" alt="image-20220108150844707"></p><p>右侧请求框</p><p><code>Overview</code>选项：会展示该请求的一个大体情况</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130122958669%20.png" alt="image-20220130122958669"></p><p><code>Content</code>选项：请求和响应的具体内容</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130123453063%20.png" alt="image-20220130123453063"></p><p><code>Summary</code>选项：也是展示请求的大体资源分布情况</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130123848881%20.png" alt="image-20220130123848881"></p><p><code>Chart</code>选项：以表格形式告诉我们一个响应时间的分布情况</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130124554030%20.png" alt="image-20220130124554030"></p><p><code>Notes</code>：点击之后可以对该请求添加笔记，方便后续查看该接口的用途。添加后，可在<code>Overview</code>中查看到</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130124200192%20.png" alt="image-20220130124200192"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130124420160%20.png" alt="image-20220130124420160"></p><h2 id="设置代理" tabindex="-1">设置代理 <a class="header-anchor" href="#设置代理" aria-label="Permalink to &quot;设置代理&quot;">​</a></h2><p>只有将设备设置了代理，才能让该设备的所有请求经过charles发出去</p><p><strong>注意</strong>：安装了charles的电脑，默认已经配置好代理了，这台电脑的所有网络访问都会经过charles。如果<strong>安装charles的设备</strong>和<strong>需要抓包的设备</strong>不是同一台那就需要设置代理了</p><p><strong>1.获取charles所在设备的IP地址和端口号</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130124844584%20.png" alt="image-20220130124844584"></p><p>弹出框中的地址就是本机IP地址</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116193359025%20.png" alt="image-20220116193359025"></p><p><strong>2.修改charles的端口号</strong></p><p>如果端口号冲突了，可以进行修改。如果不冲突，一般不用修改的</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108151846811%20.png" alt="image-20220108151846811"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220108152045980%20.png" alt="image-20220108152045980"></p><p><strong>3.给其他设备设置代理</strong></p><p>可以为android/ios或者其他win/mac设备设置代理（安装了charles的本机已经默认设置好代理了，不用再设置了）</p><p>步骤：把其他设备接入<strong>安装了charles的设备</strong>所在的局域网，并设置设备的代理为手动代理，地址是第一步获得的IP和端口（不同设备可能略有差异，但是总体思路都是，找到设备接入的局域网设置，找到代理并设置为手动，输入charles所在电脑的IP和端口）</p><p>以IOS设备为例：</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116202000807%20.png" alt="image-20220116202000807"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116202309394%20.png" alt="image-20220116202309394"></p><p><strong>4.安装证书（可以是android/ios 或者win/mac设备，本机发出的https包，若要查看也要安装charles证书）</strong></p><p>配置完代理后，charles能正常抓取http和https的包，但是https的包，会有一个小锁的标志，数据也显示unknown，content是乱码。需要给要抓包的设备安装证书，开启https代理才行</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116200209818%20.png" alt="image-20220116200209818"></p><p><strong>win或mac安装证书</strong>（以mac为例）</p><p>两个系统略有差异,但是主要思路就是把charles软件的证书安装到对应的设备上</p><p>打开<code>Help</code>----&gt;<code>SSL Proxing</code>的菜单下，有多个<code>install</code>开头的选项，这些都是安装charles证书到不同的位置（具体安装到哪里，取决于你要抓包的设备是哪个）</p><p>这里<code>Install Charles Root Certificate</code>是把证书直接下载到本机</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116200515851%20.png" alt="image-20220116200515851"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116201332656%20.png" alt="image-20220116201332656"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116201223399%20.png" alt="image-20220116201223399"></p><p><strong>手机安装证书</strong>（以IOS为例）</p><p>注意：必须使用safari浏览器</p><p>手机的https网络请求，会通过charles代理</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118142246482%20.png" alt="image-20220118142246482"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118142438885%20.png" alt="image-20220118142438885"></p><p>选择允许</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118142646254%20.png" alt="image-20220118142646254"></p><p>下一步，进入设置——&gt;通用——&gt;VPN与设备管理，找到刚才下载的描述文件，然后安装</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118150437189%20.png" alt="image-20220118150437189"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118150543541%20.png" alt="image-20220118150543541"></p><p>最后一步，进入设置——&gt;通用——&gt;关于本机——&gt;证书信任配置，找到Charles Proxy CA开启信任</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118150224914%20.png" alt="image-20220118150224914"></p><p><strong>5.设置证书代理</strong></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118143031376%20.png" alt="image-20220118143031376"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118143053070%20.png" alt="image-20220118143053070"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118143124755%20.png" alt="image-20220118143124755"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220118143140779%20.png" alt="image-20220118143140779"></p><p>这个<code>*</code>代表所有来源的请求，都会使用证书</p><h2 id="设置访问控制" tabindex="-1">设置访问控制 <a class="header-anchor" href="#设置访问控制" aria-label="Permalink to &quot;设置访问控制&quot;">​</a></h2><p>控制特定IP地址才能通过Charles访问网络</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116190112680%20.png" alt="image-20220116190112680"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/Charles%E7%9B%B8%E5%85%B3/image-20220116190546619%20.png" alt="image-20220116190546619"></p><p>提示出现，点击允许</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130120332316%20.png" alt="image-20220130120332316"></p><h2 id="设置流量控制" tabindex="-1">设置流量控制 <a class="header-anchor" href="#设置流量控制" aria-label="Permalink to &quot;设置流量控制&quot;">​</a></h2><p>流量控制可以通过控制网络情况，来实现弱网测试</p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130120430396%20.png" alt="image-20220130120430396"></p><p><img src="https://hedaodao-1256075778.cos.ap-beijing.myqcloud.com/%E8%B8%A9%E5%9D%91/image-20220130120901980%20.png" alt="image-20220130120901980"></p><h2 id="断点的使用" tabindex="-1">断点的使用 <a class="header-anchor" href="#断点的使用" aria-label="Permalink to &quot;断点的使用&quot;">​</a></h2><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><h3 id="安装charles的电脑-不能抓到自己的包" tabindex="-1">安装charles的电脑，不能抓到自己的包 <a class="header-anchor" href="#安装charles的电脑-不能抓到自己的包" aria-label="Permalink to &quot;安装charles的电脑，不能抓到自己的包&quot;">​</a></h3><p>安装charles的电脑默认已经配置了代理 （未安装ssl证书 ，需要手动安装），如果不能抓到包，很有可能是电脑安装了其他的代理工具（VPN），或者是使用的浏览器安装了某些代理插件导致的</p><h3 id="给手机配置好代理以后-部分app无法联网或报网络错误" tabindex="-1">给手机配置好代理以后，部分App无法联网或报网络错误 <a class="header-anchor" href="#给手机配置好代理以后-部分app无法联网或报网络错误" aria-label="Permalink to &quot;给手机配置好代理以后，部分App无法联网或报网络错误&quot;">​</a></h3><p>想要理解这个原因，就需要对<a href="https://blog.csdn.net/huangyaa729/article/details/88175425?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.wap_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.wap_blog_relevant_default&amp;depth_1-utm_source=distribute.wap_relevant.none-task-blog-2%7Edefault%7ECTRLIST%7Edefault-1.wap_blog_relevant_default" target="_blank" rel="noreferrer">证书的原理</a>有一定的了解，抓包工具之所以能够通过给手机安装证书的方式，解析https包的内容，其原理类似于<strong>中间人攻击的手段</strong>，即，将charles证书安装到手机系统中，当服务端返回信息被charles截获后，charles获取了真正的公钥，同时charles生成了一对假的公钥/私钥，再将信息使用假的私钥加密，发送到手机，手机的<strong>浏览器/App</strong>会从系统受信任证书中寻找charles证书，完成数据签名的校验和解密。</p><p>注意，因为google和apple开始重视安全因素，所以引入了SSL-Pinning技术：开发者预先把证书相关信息预置到App中再打包，这样在https通讯过程中，App会在<strong>内置证书和系统默认预置证书</strong>中查找服务器返回的证书，然后做签名校验，但是我们下载的charles证书是第三方证书，App根本找不到服务器返回的证书对应的本地证书，那么就被判定可能为<strong>中间人攻击（比如Fiddler/Charles抓包工具）</strong>，App客户端就会终止https链接，所以显示无法联网或报网络错误</p><p>解决方案：<a href="https://blog.csdn.net/w08023176/article/details/120333337" target="_blank" rel="noreferrer">https://blog.csdn.net/w08023176/article/details/120333337</a></p>',94)]))}const n=e(s,[["render",i]]);export{d as __pageData,n as default};
